<!doctype html>
<html lang="kr" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced/advanced" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">고급 옵션 / 설정 | K3s</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.k3s.io/kr/advanced"><meta data-rh="true" property="og:locale" content="kr"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="kr"><meta data-rh="true" name="docsearch:language" content="kr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="고급 옵션 / 설정 | K3s"><meta data-rh="true" name="description" content="이 섹션에는 K3s를 실행하고 관리할 수 있는 다양한 방법과 K3s 사용을 위해 호스트 OS를 준비하는 데 필요한 단계를 설명하는 고급 정보가 포함되어 있습니다."><meta data-rh="true" property="og:description" content="이 섹션에는 K3s를 실행하고 관리할 수 있는 다양한 방법과 K3s 사용을 위해 호스트 OS를 준비하는 데 필요한 단계를 설명하는 고급 정보가 포함되어 있습니다."><link data-rh="true" rel="icon" href="/kr/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.k3s.io/kr/advanced"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/advanced" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/zh/advanced" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/kr/advanced" hreflang="kr"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/advanced" hreflang="x-default"><link rel="stylesheet" href="/kr/assets/css/styles.9b35f8bb.css">
<script src="/kr/assets/js/runtime~main.0d8ccecf.js" defer="defer"></script>
<script src="/kr/assets/js/main.8b08c14f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="본문으로 건너뛰기"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">본문으로 건너뛰기</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="사이드바 열기/닫기" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/kr/"><div class="navbar__logo"><img src="/kr/img/k3s-logo-light.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/kr/img/k3s-logo-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="검색" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>한국어</a><ul class="dropdown__menu"><li><a href="/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li><li><a href="/kr/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="kr">한국어</a></li></ul></div><a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="밝은/어두운 모드 전환 (현재 모드: 밝은 모드)" aria-label="밝은/어두운 모드 전환 (현재 모드: 밝은 모드)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="맨 위로" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/">K3s - Lightweight Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/architecture">아키텍처</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/quick-start">빠른 시작 가이드</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/kr/installation">설치</a><button aria-label="Expand sidebar category &#x27;설치&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/kr/datastore">클러스터 데이터 저장소</a><button aria-label="Expand sidebar category &#x27;클러스터 데이터 저장소&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/cluster-access">클러스터 접근</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/kr/upgrades">업그레이드</a><button aria-label="Expand sidebar category &#x27;업그레이드&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/storage">볼륨과 저장소</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/networking">네트워킹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/helm">헬름(Helm)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/kr/advanced">고급 옵션 / 설정</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/faq">자주 묻는 질문</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/kr/cli">명령줄 도구</a><button aria-label="Expand sidebar category &#x27;명령줄 도구&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/kr/reference/env-variables">레퍼런스</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/kr/release-notes/v1.24.X">Release Notes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/kr/known-issues">알려진 이슈</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/kr/security">보안</a><button aria-label="Expand sidebar category &#x27;보안&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="페이지 경로"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="홈" class="breadcrumbs__link" href="/kr/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">고급 옵션 / 설정</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">목차 열기/닫기</button></div><div class="theme-doc-markdown markdown"><header><h1>고급 옵션 / 설정</h1></header><p>이 섹션에는 K3s를 실행하고 관리할 수 있는 다양한 방법과 K3s 사용을 위해 호스트 OS를 준비하는 데 필요한 단계를 설명하는 고급 정보가 포함되어 있습니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="인증서-관리">인증서 관리<a href="#인증서-관리" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="인증-기관-인증서">인증 기관 인증서<a href="#인증-기관-인증서" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>K3s는 첫 번째 서버 노드를 시작하는 동안 자체 서명된 CA(인증 기관) 인증서를 생성합니다. 이 CA 인증서는 10년 동안 유효하며 자동으로 갱신되지 않습니다.</p>
<p>사용자 지정 CA 인증서 사용 또는 자체 서명 CA 인증서 갱신에 대한 자세한 내용은 <a href="/kr/cli/certificate#certificate-authority-ca-certificates"><code>k3s 인증서 rotate-ca</code> 명령 설명서</a>를 참조하세요.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="클라이언트-및-서버-인증서">클라이언트 및 서버 인증서<a href="#클라이언트-및-서버-인증서" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>K3s 클라이언트 및 서버 인증서는 발급한 날로부터 365일 동안 유효합니다. 만료되었거나 만료 후 90일 이내에 만료된 인증서는 K3s를 시작할 때마다 자동으로 갱신됩니다.</p>
<p>클라이언트 및 서버 인증서를 수동으로 로테이션하는 것에 대한 정보는 <a href="/kr/cli/certificate#client-and-server-certificates"><code>k3s 인증서 로테이션</code> 명령 설명서</a>를 참조하세요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="토큰-관리">토큰 관리<a href="#토큰-관리" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>기본적으로 K3s는 서버와 에이전트 모두에 단일 정적 토큰을 사용합니다. 이 토큰은 클러스터가 생성된 후에는 변경할 수 없습니다.
에이전트 조인에만 사용할 수 있는 두 번째 정적 토큰을 활성화하거나 자동으로 만료되는 임시 <code>kubeadm</code> 스타일 조인 토큰을 생성할 수 있습니다.
자세한 내용은 <a href="/kr/cli/token"><code>k3s token</code> 명령어 설명서</a>를 참고하세요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="http-프록시-구성하기">HTTP 프록시 구성하기<a href="#http-프록시-구성하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>HTTP 프록시를 통해서만 외부와 연결할 수 있는 환경에서 K3s를 실행하는 경우, K3s 시스템드 서비스에서 프록시 설정을 구성할 수 있습니다. 그러면 이 프록시 설정이 K3s에서 사용되어 내장 컨테이너와 kubelet에 전달됩니다.</p>
<p>K3s 설치 스크립트는 자동으로 현재 셸에서 <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code> 및 <code>NO_PROXY</code> 변수와 <code>CONTAINERD_HTTP_PROXY</code>, <code>CONTAINERD_HTTPS_PROXY</code> 및 <code>CONTAINERD_NO_PROXY</code> 변수가 있는 경우 이를 systemd 서비스의 환경 파일에 작성  합니다:</p>
<ul>
<li><code>/etc/systemd/system/k3s.service.env</code></li>
<li><code>/etc/systemd/system/k3s-agent.service.env</code></li>
</ul>
<p>물론 이 파일을 편집하여 프록시를 구성할 수도 있습니다.</p>
<p>K3s는 클러스터 내부 파드 및 서비스 IP 범위와 클러스터 DNS 도메인을 자동으로 <code>NO_PROXY</code> 항목 목록에 추가합니다. 쿠버네티스 노드 자체에서 사용하는 IP 주소 범위(즉, 노드의 퍼블릭 및 프라이빗 IP)가 <code>NO_PROXY</code> 목록에 포함되어 있는지 또는 프록시를 통해 노드에 도달할 수 있는지 확인해야 합니다.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTP_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">HTTPS_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>K3s와 Kubelet에 영향을 주지 않고 컨테  이너에 대한 프록시 설정을 구성하려면, 변수 앞에 <code>CONTAINERD_</code>를 붙이면 됩니다:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_HTTP_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_HTTPS_PROXY=http://your-proxy.example.com:8888</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINERD_NO_PROXY=127.0.0.0/8,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="컨테이너-런타임으로-docker-사용">컨테이너 런타임으로 Docker 사용<a href="#컨테이너-런타임으로-docker-사용" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>K3s는 업계 표준 컨테이너 런타임인 <a href="https://containerd.io/" target="_blank" rel="noopener noreferrer">containerd</a>를 포함하며 기본값으로 사용합니다.
쿠버네티스 1.24부터, kubelet은 더 이상 kubelet이 dockerd와 통신할 수 있도록 하는 컴포넌트인 dockershim을 포함하지 않습니다.
K3s 1.24 이상에는 <a href="https://github.com/Mirantis/cri-dockerd" target="_blank" rel="noopener noreferrer">cri-dockerd</a>가 포함되어 있어 이전 릴리즈의 K3s에서 원활하게 업그레이드하면서 Docker 컨테이너 런타임을 계속 사용할 수 있습니다.</p>
<p>컨테이너 대신 Docker를 사용하려면:</p>
<ol>
<li>
<p>K3s 노드에 Docker를 설치합니다. 랜처의 <a href="https://github.com/rancher/install-docker" target="_blank" rel="noopener noreferrer">Docker 설치 스크립트</a> 중 하나를 사용하여 Docker를 설치할 수 있습니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl https://releases.rancher.com/install-docker/20.10.sh | sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><code>--docker</code> 옵션을 사용하여 K3s를 설치합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sfL https://get.k3s.io | sh -s - --docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>클러스터를 사용할 수 있는지 확인합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo k3s kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAMESPACE     NAME                                     READY   STATUS      RESTARTS   AGE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   local-path-provisioner-6d59f47c7-lncxn   1/1     Running     0          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   metrics-server-7566d596c8-9tnck          1/1     Running     0          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   helm-install-traefik-mbkn9               0/1     Completed   1          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   coredns-8655855d6-rtbnb                  1/1     Running     0          51s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   svclb-traefik-jbmvl                      2/2     Running     0          43s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kube-system   traefik-758cd5fc85-2wz97                 1/1     Running     0          43s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Docker 컨테이너가 실행 중인지 확인합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ sudo docker ps</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTAINER ID        IMAGE                     COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3e4d34729602        897ce3c5fc8f              &quot;entry&quot;                  About a minute ago   Up About a minute                       k8s_lb-port-443_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bffdc9d7a65f        rancher/klipper-lb        &quot;entry&quot;                  About a minute ago   Up About a minute                       k8s_lb-port-80_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">436b85c5e38d        rancher/library-traefik   &quot;/traefik --configfi…&quot;   About a minute ago   Up About a minute                       k8s_traefik_traefik-758cd5fc85-2wz97_kube-system_07abe831-ffd6-4206-bfa1-7c9ca4fb39e7_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">de8fded06188        rancher/pause:3.1         &quot;/pause&quot;                 About a minute ago   Up About a minute                       k8s_POD_svclb-traefik-jbmvl_kube-system_d46f10c6-073f-4c7e-8d7a-8e7ac18f9cb0_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7c6a30aeeb2f        rancher/pause:3.1         &quot;/pause&quot;                 About a minute ago   Up About a minute                       k8s_POD_traefik-758cd5fc85-2wz97_kube-system_07abe831-ffd6-4206-bfa1-7c9ca4fb39e7_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ae6c58cab4a7        9d12f9848b99              &quot;local-path-provisio…&quot;   About a minute ago   Up About a minute                       k8s_local-path-provisioner_local-path-provisioner-6d59f47c7-lncxn_kube-system_2dbd22bf-6ad9-4bea-a73d-620c90a6c1c1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">be1450e1a11e        9dd718864ce6              &quot;/metrics-server&quot;        About a minute ago   Up About a minute                       k8s_metrics-server_metrics-server-7566d596c8-9tnck_kube-system_031e74b5-e9ef-47ef-a88d-fbf3f726cbc6_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4454d14e4d3f        c4d3d16fe508              &quot;/coredns -conf /etc…&quot;   About a minute ago   Up About a minute                       k8s_coredns_coredns-8655855d6-rtbnb_kube-system_d05725df-4fb1-410a-8e82-2b1c8278a6a1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">c3675b87f96c        rancher/pause:3.1         &quot;/pause&quot;                 About a minute ago   Up About a minute                       k8s_POD_coredns-8655855d6-rtbnb_kube-system_d05725df-4fb1-410a-8e82-2b1c8278a6a1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4b1fddbe6ca6        rancher/pause:3.1         &quot;/pause&quot;                 About a minute ago   Up About a minute                       k8s_POD_local-path-provisioner-6d59f47c7-lncxn_kube-system_2dbd22bf-6ad9-4bea-a73d-620c90a6c1c1_0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">64d3517d4a95        rancher/pause:3.1         &quot;/pause&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="etcdctl-사용하기">etcdctl 사용하기<a href="#etcdctl-사용하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>etcdctl은 etcd 서버와 상호 작용하기 위한 CLI를 제공합니다. K3s는 etcdctl을 번들로 제공하지 않습니다.</p>
<p>etcdctl을 사용하여 K3s의 내장된 etcd와 상호 작용하려면 <a href="https://etcd.io/docs/latest/install/" target="_blank" rel="noopener noreferrer">공식 문서</a>를 참조하여 etcdctl을 설치하세요.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ETCD_VERSION=&quot;v3.5.5&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ETCD_URL=&quot;https://github.com/etcd-io/etcd/releases/download/${ETCD_VERSION}/etcd-${ETCD_VERSION}-linux-amd64.tar.gz&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sL ${ETCD_URL} | sudo tar -zxv --strip-components=1 -C /usr/local/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>그런 다음 인증에 K3s에서 관리하는 인증서 및 키를 사용하도록 etcdctl을 구성하여 사용할 수 있습니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo etcdctl version \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cacert=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cert=/var/lib/rancher/k3s/server/tls/etcd/client.crt \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --key=/var/lib/rancher/k3s/server/tls/etcd/client.key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="컨테이너-설정하기">컨테이너 설정하기<a href="#컨테이너-설정하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>K3s는 <code>/var/lib/rancher/k3s/agent/etc/containerd/config.toml</code>에 컨테이너에 대한 config.toml을 생성합니다.</p>
<p>이 파일에 대한 고급 커스터마이징을 위해 같은 디렉터리에 <code>config.toml.tmpl</code>이라는 다른 파일을 생성하면 이 파일이 대신 사용된다.</p>
<p><code>config.toml.tmpl</code>은 Go 템플릿 파일로 취급되며, <code>config.Node</code> 구조가 템플릿으로 전달됩니다. 이 구조를 사용하여 구성 파일을 사용자 정의하는 방법에 대한 Linux 및 Windows 예제는 <a href="https://github.com/k3s-io/k3s/blob/master/pkg/agent/templates" target="_blank" rel="noopener noreferrer">이 폴더</a>를 참조하세요.
config.Node Go 언어 구조체는 <a href="https://github.com/k3s-io/k3s/blob/master/pkg/daemons/config/types.go#L37" target="_blank" rel="noopener noreferrer">여기</a>에 정의되어 있습니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nvidia-컨테이너-런타임-지원">NVIDIA 컨테이너 런타임 지원<a href="#nvidia-컨테이너-런타임-지원" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>K3s는 K3s 시작 시 NVIDIA 컨테이너 런타임이 있으면 자동으로 감지하여 설정합니다.</p>
<ol>
<li>아래의 안내에 따라 노드에 엔비디아 컨테이너 패키지 리포지토리를 설치합니다:
<a href="https://nvidia.github.io/libnvidia-container/" target="_blank" rel="noopener noreferrer">https://nvidia.github.io/libnvidia-container/</a></li>
<li>엔비디아 컨테이너 런타임 패키지를 설치합니다. 예시:
<code>apt install -y nvidia-container-runtime cuda-drivers-fabricmanager-515 nvidia-headless-515-server</code></li>
<li>K3s를 설치하거나 이미 설치되어 있는 경우 다시 시작합니다:
<code>curl -ksL get.k3s.io | sh -</code></li>
<li>k3s가 엔비디아 컨테이너 런타임을 찾았는지 확인합니다:
<code>grep nvidia /var/lib/rancher/k3s/agent/etc/containerd/config.toml</code></li>
</ol>
<p>이렇게 하면 발견된 런타임 실행 파일에 따라 컨테이너 설정에 <code>nvidia</code> 및/또는 <code>nvidia-experimental</code> 런타임이 자동으로 추가됩니다.
여전히 클러스터에 런타임클래스 정의  를 추가하고, 파드 스펙에서 <code>runtimeClassName: nvidia</code>를 설정하여 적절한 런타임을 명시적으로 요청하는 파드를 배포해야 합니다:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> node.k8s.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RuntimeClass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nvidia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nvidia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nbody</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">gpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">benchmark</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> OnFailure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">runtimeClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nvidia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cuda</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nvcr.io/nvidia/k8s/cuda</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">sample</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">nbody</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nbody&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-gpu&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-benchmark&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">nvidia.com/gpu</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> NVIDIA_VISIBLE_DEVICES</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> NVIDIA_DRIVER_CAPABILITIES</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>엔비디아 컨테이너 런타임은 <a href="https://github.com/NVIDIA/k8s-device-plugin/" target="_blank" rel="noopener noreferrer">엔비디아 디바이스 플러그인</a> 및 <a href="https://github.com/NVIDIA/gpu-feature-discovery/" target="_blank" rel="noopener noreferrer">GPU 기능 검색</a>과 함께 자주 사용되며, 위에서 언급한 것처럼 파드 사양에 <code>runtimeClassName: nvidia</code>가 포함되도록 수정하여 별도로 설치해야 한다는 점에 유의하세요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="에이전트-없는-서버-실행하기실험적">에이전트 없는 서버 실행하기(실험적)<a href="#에이전트-없는-서버-실행하기실험적" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<blockquote>
<p><strong>경고:</strong> 이 기능은 실험 단계입니다.</p>
</blockquote>
<p><code>disable-agent</code> 플래그로 시작하  면, 서버는 kubelet, 컨테이너 런타임 또는 CNI를 실행하지 않습니다. 클러스터에 노드 리소스를 등록하지 않으며, <code>kubectl get nodes</code> 출력에 나타나지 않습니다.
에이전트리스 서버는 kubelet을 호스트하지 않기 때문에, 파드를 실행하거나 내장된 etcd 컨트롤러 및 시스템 업그레이드 컨트롤러를 포함하여 클러스터 노드를 열거하는 데 의존하는 운영자가 관리할 수 없습니다.</p>
<p>에이전트리스 서버를 실행하는 것은 클러스터 운영자 지원 부족으로 인한 관리 오버헤드 증가를 감수하고서라도 에이전트와 워크로드에 의한 검색으로부터 컨트롤 플레인 노드를 숨기고자 하는 경우에 유리할 수 있습니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="루트리스-서버-실행실험적">루트리스 서버 실행(실험적)<a href="#루트리스-서버-실행실험적" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<blockquote>
<p><strong>경고:</strong> 이 기능은 실험 단계입니다.</p>
</blockquote>
<p>루트리스 모드는 잠재적인 컨테이너 브레이크아웃 공격으로부터 호스트의 실제 루트를 보호하기 위해 권한이 없는 사용자로 K3s 서버를 실행할 수 있습니다.</p>
<p>루트리스 쿠버네티스에 대한 자세한 내용은 <a href="https://rootlesscontaine.rs/" target="_blank" rel="noopener noreferrer">https://rootlesscontaine.rs/</a> 을 참조하세요.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="루트리스-모드의-알려진-이슈">루트리스 모드의 알려진 이슈<a href="#루트리스-모드의-알려진-이슈" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<ul>
<li>
<p><strong>포트</strong></p>
<p>루트리스 실행 시 새로운 네트워크 네임스페이스가 생성됩니다. 이는 K3s 인스턴스가 호스트와 네트워킹이 상당히 분리된 상태로 실행된다는 것을 의미합니다.
호스트에서 K3s에서 실행되는 서비스에 액세스하는 유일한 방법은 K3s 네트워크 네임스페이스에 포트 포워드를 설정하는 것입니다.
루트리스 K3s에는 6443 및 1024 미만의 서비스 포트를 10000 오프셋으로 호스트에 자동으로 바인딩하는 컨트롤러가 포함되어 있습니다.</p>
<p>예를 들어, 포트 80의 서비스는 호스트에서 10080이 되지만 8080은 오프셋 없이 8080이 됩니다. 현재 로드밸런서 서비스만 자동으로 바인딩됩니다.</p>
</li>
<li>
<p><strong>Cgroup</strong></p>
<p>Cgroup v1 및 하이브리드 v1/v2는 지원되지 않으며, 순수 Cgroup v2만 지원됩니다. 루트리스 실행 시 누락된 Cgroup으로 인해 K3s가 시작되지 않는 경우, 노드가 하이브리드 모드에 있고 &quot;누락된&quot; Cgroup이 여전히 v1 컨트롤러에 바인딩되어 있을 가능성이 높습니다.</p>
</li>
<li>
<p><strong>멀티노드/멀티프로세스 클러스터</strong></p>
<p>다중 노드 루트리스 클러스터 또는 동일한 노드에 있는 여러 개의 루트리스 k3s 프로세스는 현재 지원되지 않습니다. 자세한 내용은 <a href="https://github.com/k3s-io/k3s/issues/6488#issuecomment-1314998091" target="_blank" rel="noopener noreferrer">#6488</a>을 참조하세요.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="루트리스-서버-시작하기">루트리스 서버 시작하기<a href="#루트리스-서버-시작하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<ul>
<li>
<p><a href="https://rootlesscontaine.rs/getting-started/common/cgroup2/" target="_blank" rel="noopener noreferrer">https://rootlesscontaine.rs/getting-started/common/cgroup2/</a> 을 참조하여 cgroup v2 위임을 활성화합니다.
이 단계는 필수이며, 적절한 cgroups가 위임 되지 않으면 루트리스 kubelet을 시작하지 못합니다.</p>
</li>
<li>
<p><code>https://github.com/k3s-io/k3s/blob/&lt;VERSION&gt;/k3s-rootless.service</code>](<a href="https://github.com/k3s-io/k3s/blob/master/k3s-rootless.service)%EC%97%90%EC%84%9C" target="_blank" rel="noopener noreferrer">https://github.com/k3s-io/k3s/blob/master/k3s-rootless.service)에서</a> <code>k3s-rootless.service</code>를 다운로드한다.
<code>k3s-rootless.service</code>와 <code>k3s</code>의 버전이 같은 것을 사용해야 합니다.</p>
</li>
<li>
<p><code>k3s-rootless.service</code>를 <code>~/.config/systemd/user/k3s-rootless.service</code>에 설치합니다.
이 파일을 시스템 전체 서비스(<code>/etc/systemd/...</code>)로 설치하는 것은 지원되지 않습니다.
<code>k3s</code> 바이너리의 경로에 따라 파일의 <code>ExecStart=/usr/local/bin/k3s ...</code> 행을 수정해야 할 수 있습니다.</p>
</li>
<li>
<p><code>systemctl --user daemon-reload</code>를 실행합니다.</p>
</li>
<li>
<p><code>systemctl --user enable --now k3s-rootless</code>를 실행한다.</p>
</li>
<li>
<p><code>KUBECONFIG=~/.kube/k3s.yaml kubectl get pods -A</code>를 실행하고, 파드가 실행 중인지 확인한다.</p>
</li>
</ul>
<blockquote>
<p>참고: 터미널 세션은 cgroups v2 위임을 허용하지 않으므로 터미널에서 <code>k3s server --rootless</code>를 실행하지 않는다.
터미널에서 꼭 실행해야 하는 경우, <code>systemd-run --user -p Delegate=yes --tty k3s server --roolless</code>를 사용하여 systemd 범위로 래핑합니다.</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="고급-루트리스-구성">고급 루트리스 구성<a href="#고급-루트리스-구성" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>루트리스 K3s는 호스트와 사용자 네트워크 네임스페이스 간 통신을 위해 <a href="https://github.com/rootless-containers/rootlesskit" target="_blank" rel="noopener noreferrer">rootlesskit</a> 및 <a href="https://github.com/rootless-containers/slirp4netns" target="_blank" rel="noopener noreferrer">slirp4netns</a>를 사용합니다.
루트리스킷과 slirp4net에서 사용하는 구성 중 일부는 환경 변수로 설정할 수 있습니다. 이를 설정하는 가장 좋은 방법은 k3s-rootless systemd 유닛의 <code>Environment</code> 필드에 추가하는 것입니다.</p>
<table><thead><tr><th>Variable</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>K3S_ROOTLESS_MTU</code></td><td>1500</td><td>slirp4netns 가상 인터페이스의 MTU를 설정합니다.</td></tr><tr><td><code>K3S_ROOTLESS_CIDR</code></td><td>10.41.0.0/16</td><td>slirp4netns 가상 인터페이스에서 사용하는 CIDR을 설정합니다.</td></tr><tr><td><code>K3S_ROOTLESS_ENABLE_IPV6</code></td><td>autotedected</td><td>Enables slirp4netns IPv6 지원. 지정하지 않으면 K3가 듀얼 스택 작동을 위해 구성되면 자동으로 활성화됩니다.</td></tr><tr><td><code>K3S_ROOTLESS_PORT_DRIVER</code></td><td>builtin</td><td>루트리스 포트 드라이버를 선택합니다. <code>builtin</code> 또는 <code>slirp4netns</code> 중 하나를 선택합니다. 빌트인이 더 빠르지만 인바운드 패킷의 원래 소스 주소를 가장합니다.</td></tr><tr><td><code>K3S_ROOTLESS_DISABLE_HOST_LOOPBACK</code></td><td>true</td><td>게이트웨이 인터페이스를 통한 호스트의 루프백 주소에 대한 액세스를 사용할지 여부를 제어합니다. 보안상의 이유로 변경하지 않는 것이 좋습니다.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="루트리스-문제-해결하기">루트리스 문제 해결하기<a href="#루트리스-문제-해결하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<ul>
<li><code>systemctl --user status k3s-rootless</code>를 실행하여 데몬 상태를 확인합니다.</li>
<li><code>journalctl --user -f -u k3s-rootless</code>를 실행하여 데몬 로그를 확인합니다.</li>
<li><a href="https://rootlesscontaine.rs/" target="_blank" rel="noopener noreferrer">https://rootlesscontaine.rs/</a> 참조</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="노드-레이블-및-테인트">노드 레이블 및 테인트<a href="#노드-레이블-및-테인트" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>K3s 에이전트는 <code>--node-label</code> 및 <code>--node-taint</code> 옵션으로 구성할 수 있으며, 이 옵션은 kubelet에 레이블과 테인트를 추가합니다. 이 두 옵션은 [등록 시점에] 레이블 및/또는 테인트만 추가하므로(../cli/agent.md#node-labels-and-taints-for-agents), 노드가 클러스터에 처음 조인될 때만 설정할 수 있습니다.</p>
<p>현재 모든 버전의 쿠버네티스는 노드가 <code>kubernetes.io</code> 및 <code>k8s.io</code> 접두사가 포함된 대부분의 레이블, 특히 <code>kubernetes.io/role</code> 레이블에 등록하는 것을 제한합니다. 허용되지 않는 레이블을 가진 노드를 시작하려고 하면 K3s가 시작되지 않습니다. 쿠버네티스 작성자가 언급했듯이:</p>
<blockquote>
<p>노드는 자체 역할 레이블을 어설트하는 것이 허용되지 않습니다. 노드 역할은 일반적으로 권한 또는 컨트롤 플레인 유형의 노드를 식별하는 데 사용되며, 노드가 해당 풀에 레이블을 지정하도록 허용하면 손상된 노드가 더 높은 권한 자격 증명에 대한 액세스 권한을 부여하는 워크로드(예: 컨트롤 플레인 데몬셋)를 사소하게 끌어들일 수 있습니다.</p>
</blockquote>
<p>자세한 내용은 <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-auth/279-limit-node-access/README.md#proposal" target="_blank" rel="noopener noreferrer">SIG-Auth KEP 279</a>를 참조하세 요.</p>
<p>노드 등록 후 노드 레이블과 틴트를 변경하거나 예약 레이블을 추가하려면 <code>kubectl</code>을 사용해야 합니다. <a href="https://kubernetes.io/ko/docs/concepts/scheduling-eviction/taint-and-toleration/" target="_blank" rel="noopener noreferrer">taint</a> 및 <a href="https://kubernetes.io/ko/docs/tasks/configure-pod-container/assign-pods-nodes/#add-a-label-to-a-node" target="_blank" rel="noopener noreferrer">노드 레이블</a>을 추가하는 방법에 대한 자세한 내용은 쿠버네티스 공식 문서를 참고하세요.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="설치-스크립트로-서비스-시작하기">설치 스크립트로 서비스 시작하기<a href="#설치-스크립트로-서비스-시작하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>설치 스크립트는 설치 프로세스의 일부로 OS가 systemd 또는 openrc를 사용하는지 자동으로 감지하고 서비스를 활성화 및 시작합니다.</p>
<ul>
<li>openrc로 실행하면 <code>/var/log/k3s.log</code>에 로그가 생성됩니다.</li>
<li>systemd로 실행하는 경우, <code>/var/log/syslog</code>에 로그가 생성되며 <code>journalctl -u k3s</code>(또는 에이전트에서는 <code>journalctl -u k3s-agent</code>)를 사용하여 로그를 확인할 수 있습니다.</li>
</ul>
<p>설치 스크립트로 자동 시작 및 서비스 활성화를 비활성화하는 예제입니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -sfL https://get.k3s.io | INSTALL_K3S_SKIP_START=true INSTALL_K3S_SKIP_ENABLE=true sh -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="추가-os-준비-사항">추가 OS 준비 사항<a href="#추가-os-준비-사항" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="이전-iptables-버전">이전 iptables 버전<a href="#이전-iptables-버전" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>몇몇 유명 Linux 배포판에는 중복 규칙이 누적되어 노드의 성능과 안정성에 부정적인 영향을 주는 버그가 포함된 버전의 iptables가 포함되어 있습니다. 이 문제의 영향을 받는지 확인하는 방법에 대한 자세한 내용은 <a href="https://github.com/k3s-io/k3s/issues/3117" target="_blank" rel="noopener noreferrer">Issue #3117</a>을 참조하세요.</p>
<p>K3s에는 정상적으로 작동하는 iptables(v1.8.8) 버전이 포함되어 있습니다. <code>--prefer-bundled-bin</code> 옵션으로 K3s를 시작하거나 운영 체제에서 iptables/nftables 패키지를 제거하여 K3s가 번들 버전의 iptables를 사용하도록 설정할 수 있습니다.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Version Gate</div><div class="admonitionContent_BuS1"><p><code>prefer-bundled-bin</code> 플래그는 2022-12 릴리스(v1.26.0+k3s1, v1.25.5+k3s1, v1.24.9+k3s1, v1.23.15+k3s1) 부터 사용할 수 있습니다.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="red-hat-enterprise-linux--centos">Red Hat Enterprise Linux / CentOS<a href="#red-hat-enterprise-linux--centos" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>firewalld를 끄는 것이 좋습니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl disable firewalld --now</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>방화벽을 사용하도록 설정하려면 기본적으로 다음 규칙이 필요합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">firewall-cmd --permanent --add-port=6443/tcp #apiserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">firewall-cmd --permanent --zone=trusted --add-source=10.42.0.0/16 #pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">firewall-cmd --permanent --zone=trusted --add-source=10.43.0.0/16 #services</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">firewall-cmd --reload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>설정에 따라 추가 포트를 열어야 할 수도 있습니다. 자세한 내용은 <a href="/kr/installation/requirements#inbound-rules-for-k3s-server-nodes">인바운드 규칙</a>을 참조하세요. 파드 또는 서비스에 대한 기본 CIDR을 변경하는 경우, 그에 따라 방화벽 규칙을 업데이트해야 합니다.</p>
<p>활성화된 경우, nm-cloud-setup을 비활성화하고 노드를 재부팅해야 합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl disable nm-cloud-setup.service nm-cloud-setup.timer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ubuntu">Ubuntu<a href="#ubuntu" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>ufw(uncomplicated firewall)를 끄는 것이 좋습니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ufw disable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ufw를 사용하도록 설정하려면 기본적으로 다음 규칙이 필요합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow 6443/tcp #apiserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow from 10.42.0.0/16 to any #pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ufw allow from 10.43.0.0/16 to any #services</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>설정에 따라 추가 포트를 열어야 할 수도 있습니다. 자세한 내용은 <a href="/kr/installation/requirements#inbound-rules-for-k3s-server-nodes">인바운드 규칙</a>을 참조한다. 파드 또는 서비스에 대한 기본 CIDR을 변경하는 경우, 그에 따라 방화벽 규칙을 업데이트해야 합니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="raspberry-pi">Raspberry Pi<a href="#raspberry-pi" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>라즈베리파이 OS는 데비안 기반이며, 오래된 iptables 버전으로 인해 문제가 발생할 수 있습니다. <a href="#old-iptables-versions">해결 방법</a>을 참조하세요.</p>
<p>표준 라즈베리파이 OS 설치는 <code>cgroups</code>가 활성화된 상태에서 시작되지 않습니다. <strong>K3S</strong>는 systemd 서비스를 시작하기 위해 <code>cgroups</code>가 필요합니다. <code>cgroups</code>는 <code>/boot/cmdline.txt</code>에 <code>cgroup_memory=1 cgroup_enable=memory</code>를 추가하여 활성화할 수 있습니다.</p>
<p>cmdline.txt 예시:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">console=serial0,115200 console=tty1 root=PARTUUID=58b06195-02 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait cgroup_memory=1 cgroup_enable=memory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>우분투 21.10부터 라즈베리파이의 vxlan 지원은 별도의 커널 모듈로 옮겨졌습니다.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo apt install linux-modules-extra-raspi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker에서-k3s-실행하기">Docker에서 k3s 실행하기<a href="#docker에서-k3s-실행하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>Docker에서 K3s를 실행하는 방법에는 여러 가지가 있습니다:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">K3d</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Docker</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p><a href="https://github.com/k3d-io/k3d" target="_blank" rel="noopener noreferrer">k3d</a>는 도커에서 멀티노드 K3s 클러스터를 쉽게 실행할 수 있도록 설계된 유틸리티입니다.</p><p>k3d를 사용하면 쿠버네티스의 로컬 개발 등을 위해 도커에서 단  일 노드 및 다중 노드 k3s 클러스터를 매우 쉽게 생성할 수 있습니다.</p><p>k3d 설치 및 사용 방법에 대한 자세한 내용은 <a href="https://k3d.io/#installation" target="_blank" rel="noopener noreferrer">설치</a> 설명서를 참조하세요.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>Docker를 사용하려면 <code>rancher/k3s</code> 이미지를 사용하여 K3s 서버와 에이전트를 실행할 수도 있습니다.
<code>docker run</code> 명령어를 사용합니다:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo docker run \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --privileged \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --name k3s-server-1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --hostname k3s-server-1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -p 6443:6443 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -d rancher/k3s:v1.24.10-k3s1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>비고</div><div class="admonitionContent_BuS1"><p>태그에 유효한 K3s 버전을 지정해야 하며, <code>latest</code> 태그는 유지되지 않습니다.<br>
<!-- -->도커 이미지는 태그에 <code>+</code> 기호를 허용하지 않으므로 태그에 <code>-</code>를 대신 사용하세요.</p></div></div><p>K3s가 실행되고 나면, 관리자 kubeconfig를 Docker 컨테이너에서 복사하여 사용할 수 있습니다:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo docker cp k3s-server-1:/etc/rancher/k3s/k3s.yaml ~/.kube/config</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="selinux-지원">SELinux 지원<a href="#selinux-지원" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Version Gate</div><div class="admonitionContent_BuS1"><p>v1.19.4+k3s1부터 사용 가능</p></div></div>
<p>기본적으로 SELinux가 활성화된 시스템(예로 CentOS)에 K3s를 설치하는 경우 적절한 SELinux 정책이 설치되어 있는지 확인해야 합니다.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">자동 설치</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">수동 설치</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>에어 갭(폐쇄망) 설치를 수행하지 않는 경우 호환되는 시스템에서 <a href="/kr/installation/configuration#configuration-with-install-script">설치 스크립트</a>는 랜처 RPM 저장소에서 SELinux RPM을 자동으로 설치합니다. 자동 설치는 <code>INSTALL_K3S_SKIP_SELINUX_RPM=true</code>로 설정하여 건너뛸 수 있습니다.</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>필요한 policy는 다음 명령을 사용하여 설치할 수 있습니다:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">yum install -y container-selinux selinux-policy-base</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">yum install -y https://rpm.rancher.io/k3s/latest/common/centos/7/noarch/k3s-selinux-0.2-1.el7_8.noarch.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>설치 스크립트가 실패하지 않고 경고를 기록하도록 하려면 다음 환경 변수를 설정하면 됩니다:
<code>INSTALL_K3S_SELINUX_WARN=true</code>.</p></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="selinux-적용-활성화하기">SELinux 적용 활성화하기<a href="#selinux-적용-활성화하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>SELinux를 활용하려면 K3s 서버 및 에이전트를 시작할 때 <code>--selinux</code> 플래그를 지정하세요.</p>
<p>이 옵션은 K3s <a href="/kr/installation/configuration#configuration-file">구성 파일</a>에서도 지정할 수 있습니다.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">selinux: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>SELinux에서 사용자 지정 <code>--data-dir</code>을 사용하는 것은 지원되지 않습니다. 사용자 지정하려면 사용자 지정 정책을 직접 작성해야 할 가능성이 높습니다. 컨테이너 런타임에 대한 SELinux 정책 파일이 포함된 <a href="https://github.com/containers/container-selinux" target="_blank" rel="noopener noreferrer">containers/container-selinux</a> 리포지토리와 K3s를 위한 SELinux 정책이 포함된 <a href="https://github.com/k3s-io/k3s-selinux" target="_blank" rel="noopener noreferrer">k3s-io/k3s-selinux</a> 리포지토리를 참고할 수 있습니다.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="지연-풀링의-지연-풀링-활성화-실험적">지연 풀링의 지연 풀링 활성화 (실험적)<a href="#지연-풀링의-지연-풀링-활성화-실험적" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="지연-풀링과-estargz란-무엇인가요">지연 풀링과 eStargz란 무엇인가요?<a href="#지연-풀링과-estargz란-무엇인가요" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>이미지 풀링은 컨테이너 라이프사이클에서 시간이 많이 소요되는 단계 중 하나로 알려져 있습니다.
Harter, et al.(<a href="https://www.usenix.org/conference/fast16/technical-sessions/presentation/harter" target="_blank" rel="noopener noreferrer">https://www.usenix.org/conference/fast16/technical-sessions/presentation/harter</a>),</p>
<blockquote>
<p>패키지 풀링은 컨테이너 시작 시간의 76%를 차지하지만, 그 중 읽기 데이터는 6.4%에 불과합니다.</p>
</blockquote>
<p>이 문제를 해결하기 위해 k3s는 이미지 콘텐츠의 <em>lazy pulling</em>을 실험적으로 지원합니다.
이를 통해 k3s는 전체 이미지가 풀링되기 전에 컨테이너를 시작할 수 있습니다.
대신 필요한 콘텐츠 청크(예: 개별 파일)를 온디맨드 방식으로 가져옵니다.
특히 대용량 이미지의 경우 이 기술을 사용하면 컨테이너 시작 지연 시간을 단축할 수 있습니다.</p>
<p>지연 풀링을 사용하려면 대상 이미지의 포맷을 <a href="https://github.com/containerd/stargz-snapshotter/blob/main/docs/stargz-estargz.md" target="_blank" rel="noopener noreferrer"><em>eStargz</em></a>로 지정해야 합니다.
이 형식은 OCI 대체 형식이지만 지연 풀링을 위한 100% 호환되는 이미지 형식입니다.
호환성 때문에 eStargz는 표준 컨테이너 레지스트리(예: ghcr.io)로 푸시할 수 있을 뿐만 아니라 eStargz와 무관한 런타임에서도 <em>실행 가능</em> 합니다.</p>
<p>eStargz는 <a href="https://github.com/google/crfs" target="_blank" rel="noopener noreferrer">Google CRFS 프로젝트에서 제안한 stargz 형식</a>을 기반으로 개발되었지만 콘텐츠 검증 및 성능 최적화를 포함한 실용적인 기능을 제공합니다.
지연 풀링과 eStargz에 대한 자세한 내용은 <a href="https://github.com/containerd/stargz-snapshotter" target="_blank" rel="noopener noreferrer">Stargz Snapshotter 프로젝트 리포지토리</a>를 참고하시기 바랍니다.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="지연-풀링이-가능하도록-k3s-구성하기">지연 풀링이 가능하도록 k3s 구성하기<a href="#지연-풀링이-가능하도록-k3s-구성하기" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h3>
<p>아래와 같이 k3s 서버와 에이전트에는 <code>--snapshotter=stargz</code> 옵션이 필요합니다.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s server --snapshotter=stargz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>이 구성을 사용하면, eStargz 형식의 이미지에 대해 지연 풀링을 수행할 수 있습니다.
다음 예제 파드 매니페스트는 eStargz 형식의 <code>node:13.13.0</code> 이미지(<code>ghcr.io/stargz-containers/node:13.13.0-esgz</code>)를 사용합니다.
스타즈 스냅샷터가 활성화되면 K3s는 이 이미지에 대해 지연 풀링을 수행합니다.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nodejs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> nodejs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">estargz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ghcr.io/stargz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">containers/node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">13.13.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">esgz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;node&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> var http = require(&#x27;http&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          http.createServer(function(req</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> res) </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          res.writeHead(200);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          res.end(&#x27;Hello World</span><span class="token tag" style="color:rgb(255, 85, 114)">!</span><span class="token plain">\n&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain">).listen(80);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="추가-로깅-소스">추가 로깅 소스<a href="#추가-로깅-소스" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>K3s용 <a href="https://rancher.com/docs/rancher/v2.6/en/logging/helm-chart-options/" target="_blank" rel="noopener noreferrer">랜처 로깅</a>은 랜처를 사용하지 않고 설치할 수 있습니다. 이를 위해서는 다음 지침을 실행해야 합니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo add rancher-charts https://charts.rancher.io</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm install --create-namespace -n cattle-logging-system rancher-logging-crd rancher-charts/rancher-logging-crd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm install --create-namespace -n cattle-logging-system rancher-logging --set additionalLoggingSources.k3s.enabled=true rancher-charts/rancher-logging</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="추가-네트워크-정책-로깅">추가 네트워크 정책 로깅<a href="#추가-네트워크-정책-로깅" class="hash-link" aria-label="제목에 대한 직접 링크" title="제목에 대한 직접 링크">​</a></h2>
<p>네트워크 정책에 의해 차단된 패킷을 로깅할 수 있습니다. 패킷은 차단 네트워크 정책을 포함한 패킷 세부 정보를 표시하는 iptables NFLOG 작업으로 전송됩니다.</p>
<p>트래픽이 많으면 로그 메시지 수가 매우 많아질 수 있습니다. 정책별로 로그 속도를 제어하려면, 해당 네트워크 정책에 다음 어노테이션을 추가하여 <code>limit</code> 및 <code>limit-burst</code> iptables 매개변수를 설정합니다:</p>
<ul>
<li><code>kube-router.io/netpol-nflog-limit=&lt;LIMIT-VALUE&gt;</code></li>
<li><code>kube-router.io/netpol-nflog-limit-burst=&lt;LIMIT-BURST-VALUE&gt;</code></li>
</ul>
<p>기본값은 <code>limit=10/minute</code>와 <code>limit-burst=10</code>입니다. 이러한 필드의 형식과 사용 가능한 값에 대한 자세한 내용은 <a href="https://www.netfilter.org/documentation/HOWTO/packet-filtering-HOWTO-7.html#:~:text=restrict%20the%20rate%20of%20matches" target="_blank" rel="noopener noreferrer">iptables manual</a>을 참조하세요.</p>
<p>NFLOG 패킷을 로그 항목으로 변환하려면 ulogd2를   설치하고 <code>[log1]</code>을 <code>group=100</code>에서 읽도록 구성합니다. 그런 다음 ulogd2 서비스를 다시 시작하여 새 구성이 커밋되도록 합니다.
네트워크 정책 규칙에 의해 패킷이 차단되면 <code>/var/log/ulog/syslogemu.log</code>에 로그 메시지가 나타납니다.</p>
<p>NFLOG 넷링크 소켓으로 전송된 패킷은 tcpdump 또는 tshark와 같은 명령줄 도구를 사용하여 읽을 수도 있습니다:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">tcpdump -ni nflog:100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="코드 블록 복사" title="복사" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>더 쉽게 사용할 수 있지만, tcpdump는 패킷을 차단한 네트워크 정책의 이름을 표시하지 않습니다. 대신 와이어샤크의 tshark 명령을 사용하여 정책 이름이 포함된 <code>nflog.prefix</code> 필드를 포함한 전체 NFLOG 패킷 헤더를 표시하세요.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/k3s-io/docs/edit/main/docs/advanced/advanced.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>이 페이지 편집</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">마지막 <b><time datetime="2023-11-30T20:33:00.000Z">Nov 30, 2023</time></b>에<!-- --> 업데이트</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="문서 네비게이션"><a class="pagination-nav__link pagination-nav__link--prev" href="/kr/helm"><div class="pagination-nav__sublabel">이전</div><div class="pagination-nav__label">헬름(Helm)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/kr/faq"><div class="pagination-nav__sublabel">다음</div><div class="pagination-nav__label">자주 묻는 질문</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#인증서-관리" class="table-of-contents__link toc-highlight">인증서 관리</a><ul><li><a href="#인증-기관-인증서" class="table-of-contents__link toc-highlight">인증 기관 인증서</a></li><li><a href="#클라이언트-및-서버-인증서" class="table-of-contents__link toc-highlight">클라이언트 및 서버 인증서</a></li></ul></li><li><a href="#토큰-관리" class="table-of-contents__link toc-highlight">토큰 관리</a></li><li><a href="#http-프록시-구성하기" class="table-of-contents__link toc-highlight">HTTP 프록시 구성하기</a></li><li><a href="#컨테이너-런타임으로-docker-사용" class="table-of-contents__link toc-highlight">컨테이너 런타임으로 Docker 사용</a></li><li><a href="#etcdctl-사용하기" class="table-of-contents__link toc-highlight">etcdctl 사용하기</a></li><li><a href="#컨테이너-설정하기" class="table-of-contents__link toc-highlight">컨테이너 설정하기</a></li><li><a href="#nvidia-컨테이너-런타임-지원" class="table-of-contents__link toc-highlight">NVIDIA 컨테이너 런타임 지원</a></li><li><a href="#에이전트-없는-서버-실행하기실험적" class="table-of-contents__link toc-highlight">에이전트 없는 서버 실행하기(실험적)</a></li><li><a href="#루트리스-서버-실행실험적" class="table-of-contents__link toc-highlight">루트리스 서버 실행(실험적)</a><ul><li><a href="#루트리스-모드의-알려진-이슈" class="table-of-contents__link toc-highlight">루트리스 모드의 알려진 이슈</a></li><li><a href="#루트리스-서버-시작하기" class="table-of-contents__link toc-highlight">루트리스 서버 시작하기</a></li><li><a href="#고급-루트리스-구성" class="table-of-contents__link toc-highlight">고급 루트리스 구성</a></li><li><a href="#루트리스-문제-해결하기" class="table-of-contents__link toc-highlight">루트리스 문제 해결하기</a></li></ul></li><li><a href="#노드-레이블-및-테인트" class="table-of-contents__link toc-highlight">노드 레이블 및 테인트</a></li><li><a href="#설치-스크립트로-서비스-시작하기" class="table-of-contents__link toc-highlight">설치 스크립트로 서비스 시작하기</a></li><li><a href="#추가-os-준비-사항" class="table-of-contents__link toc-highlight">추가 OS 준비 사항</a><ul><li><a href="#이전-iptables-버전" class="table-of-contents__link toc-highlight">이전 iptables 버전</a></li><li><a href="#red-hat-enterprise-linux--centos" class="table-of-contents__link toc-highlight">Red Hat Enterprise Linux / CentOS</a></li><li><a href="#ubuntu" class="table-of-contents__link toc-highlight">Ubuntu</a></li><li><a href="#raspberry-pi" class="table-of-contents__link toc-highlight">Raspberry Pi</a></li></ul></li><li><a href="#docker에서-k3s-실행하기" class="table-of-contents__link toc-highlight">Docker에서 k3s 실행하기</a></li><li><a href="#selinux-지원" class="table-of-contents__link toc-highlight">SELinux 지원</a><ul><li><a href="#selinux-적용-활성화하기" class="table-of-contents__link toc-highlight">SELinux 적용 활성화하기</a></li></ul></li><li><a href="#지연-풀링의-지연-풀링-활성화-실험적" class="table-of-contents__link toc-highlight">지연 풀링의 지연 풀링 활성화 (실험적)</a><ul><li><a href="#지연-풀링과-estargz란-무엇인가요" class="table-of-contents__link toc-highlight">지연 풀링과 eStargz란 무엇인가요?</a></li><li><a href="#지연-풀링이-가능하도록-k3s-구성하기" class="table-of-contents__link toc-highlight">지연 풀링이 가능하도록 k3s 구성하기</a></li></ul></li><li><a href="#추가-로깅-소스" class="table-of-contents__link toc-highlight">추가 로깅 소스</a></li><li><a href="#추가-네트워크-정책-로깅" class="table-of-contents__link toc-highlight">추가 네트워크 정책 로깅</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 K3s Project Authors. All rights reserved. <br>The Linux Foundation has registered trademarks
      and uses trademarks. For a list of trademarks of The Linux Foundation, 
      please see our <a href="https://www.linuxfoundation.org/trademark-usage"> Trademark Usage</a> page.</div></div></div></footer></div>
</body>
</html>