"use strict";(self.webpackChunkk_3_s_docs=self.webpackChunkk_3_s_docs||[]).push([[1885],{94016:(e,i,r)=>{r.r(i),r.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"add-ons/import-images","title":"Import Images","description":"Container images are cached locally on each node by the containerd image store. Images can be pulled from the registry as needed by pods, preloaded via image pull, or imported from an image tarball.","source":"@site/docs/add-ons/import-images.md","sourceDirName":"add-ons","slug":"/add-ons/import-images","permalink":"/add-ons/import-images","draft":false,"unlisted":false,"editUrl":"https://github.com/k3s-io/docs/edit/main/docs/add-ons/import-images.md","tags":[],"version":"current","lastUpdatedAt":1761756638000,"frontMatter":{"title":"Import Images"},"sidebar":"mySidebar","previous":{"title":"Helm","permalink":"/add-ons/helm"},"next":{"title":"Volumes and Storage","permalink":"/add-ons/storage"}}');var t=r(74848),a=r(28453);const s={title:"Import Images"},o=void 0,l={},d=[{value:"On-demand image pulling",id:"on-demand-image-pulling",level:2},{value:"Pre-import images",id:"pre-import-images",level:2},{value:"Set up an image registry",id:"set-up-an-image-registry",level:2}];function c(e){const i={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{TabItem:r,Tabs:n}=i;return r||g("TabItem",!0),n||g("Tabs",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.p,{children:"Container images are cached locally on each node by the containerd image store. Images can be pulled from the registry as needed by pods, preloaded via image pull, or imported from an image tarball."}),"\n",(0,t.jsx)(i.h2,{id:"on-demand-image-pulling",children:"On-demand image pulling"}),"\n",(0,t.jsxs)(i.p,{children:["Kubernetes, by default, automatically pulls images when a Pod requires them if the image is not already present on the node. This behavior can be changed by using the ",(0,t.jsx)(i.a,{href:"https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy",children:"image pull policy"})," field of the Pod. When using the default ",(0,t.jsx)(i.code,{children:"IfNotPresent"})," policy, containerd will pull the image from either upstream (default) or your ",(0,t.jsx)(i.a,{href:"/installation/private-registry",children:"private registry"})," and store it in its image store. Users do not need to apply any additional configuration for on-demand image pulling to work."]}),"\n",(0,t.jsx)(i.h2,{id:"pre-import-images",children:"Pre-import images"}),"\n",(0,t.jsx)(i.admonition,{title:"Version Gate",type:"info",children:(0,t.jsx)(i.p,{children:"The pre-importing of images while K3s is running feature is available as of January 2025 releases: v1.32.0+k3s1, v1.31.5+k3s1, v1.30.9+k3s1, v1.29.13+k3s1. Before that, K3s pre-imported the images only when booting."})}),"\n",(0,t.jsxs)(i.p,{children:["Pre-importing images onto the node is essential if you configure Kubernetes' ",(0,t.jsx)(i.code,{children:"imagePullPolicy"})," as ",(0,t.jsx)(i.code,{children:"Never"}),". You might do this for security reasons or to reduce the time it takes for your K3s nodes to spin up."]}),"\n",(0,t.jsx)(i.p,{children:"K3s includes two mechanisms to pre-import images into the containerd image store:"}),"\n",(0,t.jsxs)(n,{groupId:"import-images",queryString:!0,children:[(0,t.jsxs)(r,{value:"Online image importing",default:!0,children:[(0,t.jsxs)(i.p,{children:["Users can trigger a pull of images into the containerd image store by placing a text file containing the image names, one per line, in the ",(0,t.jsx)(i.code,{children:"/var/lib/rancher/k3s/agent/images"})," directory. The text file can be placed before K3s is started, or created/modified while K3s is running. K3s will sequentially pull the images via the CRI API, optionally using the ",(0,t.jsx)(i.a,{href:"/installation/private-registry",children:"registries.yaml"})," configuration."]}),(0,t.jsx)(i.p,{children:"For example:"}),(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"mkdir /var/lib/rancher/k3s/agent/images\ncp example.txt /var/lib/rancher/k3s/agent/images\n"})}),(0,t.jsxs)(i.p,{children:["Where ",(0,t.jsx)(i.code,{children:"example.txt"})," contains:"]}),(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{children:"docker.io/library/redis:latest\ndocker.io/library/mysql:latest\n"})}),(0,t.jsxs)(i.p,{children:["After a few seconds, the ",(0,t.jsx)(i.code,{children:"redis"})," and the ",(0,t.jsx)(i.code,{children:"mysql"})," images will be available in the containerd image store of the node."]}),(0,t.jsxs)(i.p,{children:["Use ",(0,t.jsx)(i.code,{children:"sudo k3s ctr images list"})," to query the containerd image store."]})]}),(0,t.jsxs)(r,{value:"Offline image importing",children:[(0,t.jsxs)(i.p,{children:["Users can import images directly into the containerd image store by placing image tarballs in the ",(0,t.jsx)(i.code,{children:"/var/lib/rancher/k3s/agent/images"})," directory. The tarball can be placed before K3s is started, or created/modified while K3s is running. K3s will decompress the image tarball if necessary, extract the images, and load them into the containerd image store."]}),(0,t.jsx)(i.p,{children:"For example:"}),(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-bash",children:"mkdir /var/lib/rancher/k3s/agent/images\ncurl  https://github.com/k3s-io/k3s/releases/download/v1.33.1%2Bk3s1/k3s-airgap-images-amd64.tar.zst -O  /var/lib/rancher/k3s/agent/images/k3s-airgap-images-amd64.tar.zst\n"})}),(0,t.jsx)(i.p,{children:"After a few seconds, the images included in the image tarball will be available in the containerd image store of the node."}),(0,t.jsxs)(i.p,{children:["Use ",(0,t.jsx)(i.code,{children:"sudo k3s ctr images list"})," to query the containerd image store."]}),(0,t.jsxs)(i.p,{children:["This is the method used in Airgap. Please follow the ",(0,t.jsx)(i.a,{href:"/installation/airgap",children:"Airgap install documentation"})," for detailed information."]})]})]}),"\n",(0,t.jsx)(i.h2,{id:"set-up-an-image-registry",children:"Set up an image registry"}),"\n",(0,t.jsx)(i.p,{children:"K3s supports two alternatives for image registries:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.a,{href:"/installation/private-registry",children:"Private Registry Configuration"})," covers use of ",(0,t.jsx)(i.code,{children:"registries.yaml"})," to configure container image registry authentication and mirroring."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.a,{href:"/installation/registry-mirror",children:"Embedded Registry Mirror"})," shows how to enable the embedded distributed image registry mirror, for peer-to-peer sharing of images between nodes."]}),"\n"]}),"\n"]})]})}function m(e={}){const{wrapper:i}={...(0,a.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}function g(e,i){throw new Error("Expected "+(i?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,i,r)=>{r.d(i,{R:()=>s,x:()=>o});var n=r(96540);const t={},a=n.createContext(t);function s(e){const i=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),n.createElement(a.Provider,{value:i},e.children)}}}]);