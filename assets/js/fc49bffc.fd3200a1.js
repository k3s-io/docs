"use strict";(self.webpackChunkk_3_s_docs=self.webpackChunkk_3_s_docs||[]).push([[4462],{8154:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>_,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"reference/metrics","title":"Metrics","description":"K3s provides metrics for monitoring the health and performance of the cluster.","source":"@site/docs/reference/metrics.md","sourceDirName":"reference","slug":"/reference/metrics","permalink":"/reference/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/k3s-io/docs/edit/main/docs/reference/metrics.md","tags":[],"version":"current","lastUpdatedAt":1756834420000,"frontMatter":{"title":"Metrics"},"sidebar":"mySidebar","previous":{"title":"Flag Deprecation","permalink":"/reference/flag-deprecation"},"next":{"title":"Resource Profiling","permalink":"/reference/resource-profiling"}}');var t=n(4848),i=n(8453);n(6540);function c({children:e}){return(0,t.jsx)("span",{style:{backgroundColor:"var(--label-color)",color:"var(--ifm-color-content)",padding:"0.2rem 0.5rem",margin:"0 0.2rem",borderRadius:"3px",border:"1px solid #d0d7de",whiteSpace:"nowrap"},children:e})}const l={title:"Metrics"},a=void 0,o={},d=[{value:"Supervisor Metrics",id:"supervisor-metrics",level:2},{value:"K3s Cluster Management Metrics",id:"k3s-cluster-management-metrics",level:2},{value:"k3s_certificate_expiration_seconds",id:"k3s_certificate_expiration_seconds",level:3},{value:"k3s_loadbalancer_server_connections",id:"k3s_loadbalancer_server_connections",level:3},{value:"k3s_loadbalancer_server_health",id:"k3s_loadbalancer_server_health",level:3},{value:"k3s_loadbalancer_dial_duration_seconds",id:"k3s_loadbalancer_dial_duration_seconds",level:3},{value:"k3s_etcd_snapshot_save_duration_seconds",id:"k3s_etcd_snapshot_save_duration_seconds",level:3},{value:"k3s_etcd_snapshot_save_local_duration_seconds",id:"k3s_etcd_snapshot_save_local_duration_seconds",level:3},{value:"k3s_etcd_snapshot_save_s3_duration_seconds",id:"k3s_etcd_snapshot_save_s3_duration_seconds",level:3},{value:"k3s_etcd_snapshot_reconcile_duration_seconds",id:"k3s_etcd_snapshot_reconcile_duration_seconds",level:3},{value:"k3s_etcd_snapshot_reconcile_local_duration_seconds",id:"k3s_etcd_snapshot_reconcile_local_duration_seconds",level:3},{value:"k3s_etcd_snapshot_reconcile_s3_duration_seconds",id:"k3s_etcd_snapshot_reconcile_s3_duration_seconds",level:3}];function h(e){const s={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"K3s provides metrics for monitoring the health and performance of the cluster."}),"\n",(0,t.jsx)(s.p,{children:"Most metrics are provided by individual components. See the following component-specific documentation for more information:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://coredns.io/plugins/metrics/",children:"coredns metrics"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://etcd.io/docs/v3.5/metrics/",children:"etcd metrics"})}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Additional metrics may be provided by other components. Consult the upstream project documentation for any components not listed above."}),"\n",(0,t.jsx)(s.h2,{id:"supervisor-metrics",children:"Supervisor Metrics"}),"\n",(0,t.jsxs)(s.p,{children:["When K3s is started with ",(0,t.jsx)(s.code,{children:"supervisor-metrics: true"}),", metrics are exposed by the K3s process and can be accessed via the ",(0,t.jsx)(s.code,{children:"/metrics"})," endpoint on each node at port ",(0,t.jsx)(s.code,{children:"6443"}),":"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"kubectl get --server https://NODENAME:6443 --raw /metrics\n"})}),"\n",(0,t.jsx)(s.p,{children:"Metrics exposed by the K3s supervisor process include:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"K3s Cluster Management Metrics"}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/rancher/lasso/blob/main/README.md#lasso-controller",children:"Lasso controller metrics"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/kubernetes/client-go/blob/master/README.md",children:"Kubernetes client and workqueue metrics"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/reference/instrumentation/node-metrics/",children:"Kubernetes Node Metrics"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/reference/instrumentation/metrics/",children:"Kubernetes Component Metrics"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://pkg.go.dev/runtime/metrics#hdr-Supported_metrics",children:"Go runtime metrics"})}),"\n",(0,t.jsxs)(s.li,{children:["If the K3s embedded registry is enabled, ",(0,t.jsx)(s.a,{href:"https://spegel.dev/docs/metrics/",children:"Spegel metrics"})," and ",(0,t.jsx)(s.a,{href:"https://github.com/libp2p/go-libp2p/blob/master/README.md",children:"libp2p metrics"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"K3s runs all Kubernetes components in the main K3s process.\nSince Kubernetes uses a single Prometheus metric registry per process, metrics for all components are available via all exposed metrics endpoints.\nIf you scrape all the individual metrics endpoints, you may find that you are collecting duplicate metrics.\nIt is only necessary to scrape a single K3s metric endpoint in order to get metrics for all embedded Kubernetes components."}),"\n",(0,t.jsx)(s.h2,{id:"k3s-cluster-management-metrics",children:"K3s Cluster Management Metrics"}),"\n",(0,t.jsx)(s.h3,{id:"k3s_certificate_expiration_seconds",children:"k3s_certificate_expiration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Remaining lifetime in seconds of the certificate, labeled by certificate subject and usages."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Gauge"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"subject"})," ",(0,t.jsx)(c,{children:"usage"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_loadbalancer_server_connections",children:"k3s_loadbalancer_server_connections"}),"\n",(0,t.jsx)(s.p,{children:"Count of current connections to loadbalancer server, labeled by loadbalancer name and server address."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Gauge"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"name"})," ",(0,t.jsx)(c,{children:"server"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_loadbalancer_server_health",children:"k3s_loadbalancer_server_health"}),"\n",(0,t.jsxs)(s.p,{children:["Current health state of loadbalancer backend servers, labeled by loadbalancer name and server address.",(0,t.jsx)(s.br,{}),"\n","State is enum of 0=INVALID, 1=FAILED, 2=STANDBY, 3=UNCHECKED, 4=RECOVERING, 5=HEALTHY, 6=PREFERRED, 7=ACTIVE."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Gauge"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"name"})," ",(0,t.jsx)(c,{children:"server"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_loadbalancer_dial_duration_seconds",children:"k3s_loadbalancer_dial_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Time in seconds taken to dial a connection to a backend server, labeled by loadbalancer name and success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"name"})," ",(0,t.jsx)(c,{children:"status"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_etcd_snapshot_save_duration_seconds",children:"k3s_etcd_snapshot_save_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Total time in seconds taken to complete the etcd snapshot process, labeled by success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histrogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"status"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_etcd_snapshot_save_local_duration_seconds",children:"k3s_etcd_snapshot_save_local_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Total time in seconds taken to save a local snapshot file, labeled by success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histrogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"status"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_etcd_snapshot_save_s3_duration_seconds",children:"k3s_etcd_snapshot_save_s3_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Total time in seconds taken to upload a snapshot file to S3, labeled by success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histrogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"status"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_etcd_snapshot_reconcile_duration_seconds",children:"k3s_etcd_snapshot_reconcile_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Total time in seconds taken to sync the list of etcd snapshots, labeled by success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histrogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"status"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_etcd_snapshot_reconcile_local_duration_seconds",children:"k3s_etcd_snapshot_reconcile_local_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Total time in seconds taken to list local snapshot files, labeled by success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histrogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"status"})]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"k3s_etcd_snapshot_reconcile_s3_duration_seconds",children:"k3s_etcd_snapshot_reconcile_s3_duration_seconds"}),"\n",(0,t.jsx)(s.p,{children:"Total time in seconds taken to list S3 snapshot files, labeled by success/failure status."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Type: Histrogram"}),"\n",(0,t.jsxs)(s.li,{children:["Labels: ",(0,t.jsx)(c,{children:"status"})]}),"\n"]})]})}function _(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>l});var r=n(6540);const t={},i=r.createContext(t);function c(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);