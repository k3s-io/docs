<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">K3s strategies for image consumption | K3s</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.k3s.io/zh/blog/2025/11/11/strategies-for-large-images"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="K3s strategies for image consumption | K3s"><meta data-rh="true" name="description" content="Master online and offline image loading techniques in K3s for ultra-fast application startup, even with multi-gigabyte containers."><meta data-rh="true" property="og:description" content="Master online and offline image loading techniques in K3s for ultra-fast application startup, even with multi-gigabyte containers."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-11-11T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/manuelbuil"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.k3s.io/zh/blog/2025/11/11/strategies-for-large-images"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/blog/2025/11/11/strategies-for-large-images" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/zh/blog/2025/11/11/strategies-for-large-images" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/ja/blog/2025/11/11/strategies-for-large-images" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/blog/2025/11/11/strategies-for-large-images" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://docs.k3s.io/zh/blog/2025/11/11/strategies-for-large-images","mainEntityOfPage":"https://docs.k3s.io/zh/blog/2025/11/11/strategies-for-large-images","url":"https://docs.k3s.io/zh/blog/2025/11/11/strategies-for-large-images","headline":"K3s strategies for image consumption","name":"K3s strategies for image consumption","description":"Master online and offline image loading techniques in K3s for ultra-fast application startup, even with multi-gigabyte containers.","datePublished":"2025-11-11T00:00:00.000Z","author":{"@type":"Person","name":"Manuel Buil","description":"K3s maintainer","url":"https://github.com/manuelbuil","image":"https://github.com/manuelbuil.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://docs.k3s.io/zh/blog","name":"k3s blog"}}</script><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="K3s RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="K3s Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RWWWC4YDC"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0RWWWC4YDC",{anonymize_ip:!0})</script><link rel="stylesheet" href="/zh/assets/css/styles.4ddf4ca9.css">
<script src="/zh/assets/js/runtime~main.c7da8819.js" defer="defer"></script>
<script src="/zh/assets/js/main.92a9bd30.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/zh/img/k3s-logo-light.svg"><link rel="preload" as="image" href="/zh/img/k3s-logo-dark.svg"><link rel="preload" as="image" href="https://github.com/manuelbuil.png"><div role="region" aria-label="Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><nav aria-label="‰∏ªÂØºËà™" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/k3s-logo-light.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/k3s-logo-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="ÊêúÁ¥¢" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>ÁÆÄ‰Ωì‰∏≠Êñá</a><ul class="dropdown__menu"><li><a href="/blog/2025/11/11/strategies-for-large-images" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/blog/2025/11/11/strategies-for-large-images" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">ÁÆÄ‰Ωì‰∏≠Êñá</a></li><li><a href="/ja/blog/2025/11/11/strategies-for-large-images" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">Êó•Êú¨Ë™û</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__icon navbar__blog navbar__link--active" href="/zh/blog">Blog</a><a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon navbar__github">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫system modeÔºâ"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="ÊúÄËøëÂçöÊñáÂØºËà™"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2026/01/15/K3s-1.35-release">Kubernetes v1.35 is out!</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/zh/blog/2025/11/11/strategies-for-large-images">K3s strategies for image consumption</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/09/27/k3s-sysbox">Sysbox Runtime With K3s</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/08/30/K3s-1.34-release">Kubernetes v1.34 is out!</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/03/25/K3s-initialization">K3s initialization deep dive</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/03/10/simple-ha">The Basic HA Cluster</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/03/09/hello-blog">Hello Blog</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">K3s strategies for image consumption</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-11-11T00:00:00.000Z">2025Âπ¥11Êúà11Êó•</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/manuelbuil" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/manuelbuil.png" alt="Manuel Buil"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/manuelbuil" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp" translate="no">Manuel Buil</span></a></div><small class="authorTitle_nd0D" title="K3s maintainer">K3s maintainer</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Slow image pulls can be annoying and may increase Kubernetes startup times over a healthy threshold, particularly in resource-constrained or air-gapped environments. The situation is exacerbated by new AI-driven apps, which often rely on astronomically large images, frequently tens or hundreds of gigabytes. This post dives into mechanisms that K3s makes available to improve the user&#x27;s experience when handling large images.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="online--offline-strategies-the-power-of-local-import-">Online &amp; Offline Strategies: The Power of Local Import üì¶<a href="#online--offline-strategies-the-power-of-local-import-" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" translate="no">‚Äã</a></h2>
<p>K3s provides mechanisms for ensuring large images are available quickly, that address two common scenarios:</p>
<ul>
<li class="">Online Clusters: To avoid slow image pulls from an external registry when a pod starts, K3s can <code>pre-pull</code> images from a manifest file.</li>
<li class="">Offline (Air-Gapped) Clusters: Where no external registry is available, K3s can <code>import</code> images directly from local tarball archives.</li>
</ul>
<ol>
<li class="">Pre-Pulling Images via a Manifest File (Online)
In scenarios with internet connectivity, the goal is to initiate image pulls as early and efficiently as possible. K3s can be instructed to sequentially pull a set of images into the embedded containerd store during startup or while K3s is running. This is ideal for ensuring base images are ready the moment the cluster starts or the moment the application is deployed. However, if this process is done before the cluster is started, K3s won&#x27;t successfully start until all images have been pulled, which could make K3s fail to start if it takes more than 15 minutes. If you suspect this is happening to you, you&#x27;d better do the pre-pulling while K3s is running.</li>
</ol>
<p>Users can trigger a pull of images into the containerd image store by placing a simple text file containing the image names, one per line, in the <code>/var/lib/rancher/k3s/agent/images</code> directory. As we have just explained, this can be done before K3s starts or while K3s is running. For example, you can execute the following in one of the nodes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-p</span><span class="token plain"> /var/lib/rancher/k3s/agent/images </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> docker.io/pytorch/pytorch:2.9.0-cuda12.6-cudnn9-runtime </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> /var/lib/rancher/k3s/agent/images/pytorch.txt</span><br></span></code></pre></div></div>
<p>In the previous command, we have created the images directory on the node and dropped a file names <code>pytorch.txt</code> that contains the image: <code>docker.io/pytorch/pytorch:2.9.0-cuda12.6-cudnn9-runtime</code>.</p>
<p>The K3s process will then pull these images via the CRI API. You should see the following two logs:</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token plain"> When the k3s controller detects the file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Pulling images from /var/lib/rancher/k3s/agent/images/example.txt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Pulling image docker.io/pytorch/pytorch:2.9.0-cuda12.6-cudnn9-runtime&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">#</span><span class="token plain"> When the import is ready</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> It specifies how much time it took in ms</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Imported docker.io/pytorch/pytorch:2.9.0-cuda12.6-cudnn9-runtime&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Imported images from /var/lib/rancher/k3s/agent/images/example.txt in 6m1.178972902s&quot;</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Importing Images from Tarballs (Offline &amp; Ultra-Fast)</li>
</ol>
<p>For the absolute fastest startup‚Äîcritical or when being in an air-gapped environment, the images should be available locally as tarballs. K3s will load these images directly into the containerd image store, bypassing any network traffic entirely.</p>
<p>Place the image tarballs (created using docker save or ctr save) in the same /var/lib/rancher/k3s/agent/images directory. K3s will decompress the tarball, extract the image layers, and load them.</p>
<p>For example, I have created an image tarball with all the images required to deploy the popular <a href="https://github.com/GoogleCloudPlatform/microservices-demo" target="_blank" rel="noopener noreferrer" class="">microservices-demo</a> with the name <code>microservices-demo.tar.gz</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Example: Save the image and place the tarball</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-p</span><span class="token plain"> /var/lib/rancher/k3s/agent/images</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> microservices-demo.tar.gz /var/lib/rancher/k3s/agent/images/</span><br></span></code></pre></div></div>
<p>The K3s process will load those images and you should see the following two logs:</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Importing images from /var/lib/rancher/k3s/agent/images/microservices-demo.tar.gz&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">&quot;Imported images from </span><span class="token file-path string" style="color:rgb(195, 232, 141)">/var/lib/rancher/k3s/agent/images/microservices-demo.tar.gz</span><span class="token plain"> in 1m39</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">8610592s</span><br></span></code></pre></div></div>
<p>You can verify the successfully imported images at any time using the bundled client: <code>k3s ctr images list</code></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="optimizing-booting-times-with-tarballs">Optimizing booting times with tarballs<a href="#optimizing-booting-times-with-tarballs" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" translate="no">‚Äã</a></h3>
<p>By default, image archives are imported every time K3s starts to ensure consistency. However, this delay can be significant when dealing with many large archives, for example, <code>microservices-demo.tar.gz</code> took 1m39s to import. To alleviate this, K3s offers a feature to only import tarballs that have changed since they were last processed. To enable this feature, create an empty <code>.cache.json</code> file in the images directory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">touch</span><span class="token plain"> /var/lib/rancher/k3s/agent/images/.cache.json</span><br></span></code></pre></div></div>
<p>The cache file will store archive metadata (size and modification time). Subsequent restarts of K3s will check this file and skip the import process for any large tarballs that haven&#x27;t changed, dramatically speeding up cluster boot time. Therefore, to check that this is working, check <code>.cache.json</code> is not empty and, after restarting, that the two log lines do not appear anymore.</p>
<p>Note that the caching mechanism needs to be enabled carefully. If an image was removed or pruned since last startup, take manual action to reimport the image. Check our <a href="https://docs.k3s.io/installation/airgap?_highlight=.cache.json&amp;airgap-load-images=Manually+Deploy+Images#enable-conditional-image-imports" target="_blank" rel="noopener noreferrer" class="">docs</a> for more information.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="embedded-registry-mirror-Ô∏è">Embedded Registry Mirror üï∏Ô∏è<a href="#embedded-registry-mirror-Ô∏è" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" translate="no">‚Äã</a></h2>
<p>K3s offers an in-cluster container image registry mirror by embedding <a href="https://spegel.dev/" target="_blank" rel="noopener noreferrer" class="">Spegel</a>. Its primary use case is to accelerate image pulling and reduce external network dependency in Kubernetes clusters by allowing nodes to pull cached image content directly from other nodes whenever possible, instead of requiring each node to reach out to a central registry. To enable this feature, server nodes must be started with the <code>--embedded-registry</code> flag, or with <code>embedded-registry: true</code> in the configuration file. When enabled, every node in your cluster instantly becomes a stateless, local image mirror listening on port 6443. Nodes share a constantly updated list of available images over a peer-to-peer network on port 5001.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Enable the embedded registry mirror</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">embedded-registry: </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># To enable metrics that can help with the embedded registry mirror</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">supervisor-metrics: </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"> </span><br></span></code></pre></div></div>
<p>And then, on all nodes, you must add a <code>registries.yaml</code> where we specified what registries to allow a node to both push and pull images with other nodes. If a registry is enabled for mirroring on some nodes, but not on others, only the nodes with the registry enabled will exchange images. For example:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">mirrors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">docker.io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  registry.k8s.io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><br></span></code></pre></div></div>
<p>If everything boots up correctly, you should see in the logs:</p>
<div class="language-log codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-log codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Starting distributed registry mirror at https://10.11.0.11:6443/v2 for registries [docker.io registry.k8s.io]&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">level</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">info msg</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Starting distributed registry P2P node at 10.11.0.11:5001&quot;</span><br></span></code></pre></div></div>
<p>And you should be able to see metrics of Spegel by querying the supervisor metrics server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--server</span><span class="token plain"> https://10.11.0.11:6443 </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--raw</span><span class="token plain"> /metrics  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">grep</span><span class="token plain"> spegel</span><br></span></code></pre></div></div>
<p>For more information check the <a href="https://docs.k3s.io/installation/registry-mirror" target="_blank" rel="noopener noreferrer" class="">docs</a></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="bonus-estargz-images-">Bonus: eStargz images ‚ö°<a href="#bonus-estargz-images-" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" translate="no">‚Äã</a></h2>
<p>A different solution to speed up the creation of pods is by using a special image format called eStargz. This enables lazy pulling, which means that the application can start almost instantly while the rest of the image is pulled in the background. This strategy requires both the image to be specifically built in the eStargz format and the K3s agent to be configured to use the stargz snapshotter: <code>--snapshotter=estargz</code> flag, or with <code>snapshotter: estargz</code> in the configuration file.</p>
<p>This is currently an experimental feature in K3s and we have more information in the <a href="https://docs.k3s.io/advanced#enabling-lazy-pulling-of-estargz-experimental" target="_blank" rel="noopener noreferrer" class="">advanced section of our docs</a>. We would love to hear your feedback if you are using it.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion-">Conclusion üèÅ<a href="#conclusion-" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" translate="no">‚Äã</a></h2>
<p>K3s provides robust, flexible tools to tackle slow image pulls, a problem magnified by today&#x27;s multi-gigabyte cloud-native and AI images. By leveraging pre-pulling manifest strategies, tarball loading or optimizing image distribution with the embedded <a href="https://spegel.dev/" target="_blank" rel="noopener noreferrer" class="">Spegel</a> registry mirror, you can shift slow network operations into quick local operations. These mechanisms ensure your resource-constrained and air-gapped clusters achieve rapid, predictable startup times, delivering a consistently better user experience.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ÂçöÊñáÂàÜÈ°µÂØºËà™"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/blog/2026/01/15/K3s-1.35-release"><div class="pagination-nav__sublabel">ËæÉÊñ∞‰∏ÄÁØá</div><div class="pagination-nav__label">Kubernetes v1.35 is out!</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/blog/2025/09/27/k3s-sysbox"><div class="pagination-nav__sublabel">ËæÉÊóß‰∏ÄÁØá</div><div class="pagination-nav__label">Sysbox Runtime With K3s</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2026 K3s Project Authors. All rights reserved. <br>The Linux Foundation has registered trademarks
      and uses trademarks. For a list of trademarks of The Linux Foundation, 
      please see our <a href="https://www.linuxfoundation.org/trademark-usage"> Trademark Usage</a> page.</div></div></div></footer></div>
</body>
</html>