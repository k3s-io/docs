<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">K3s initialization deep dive | K3s</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.k3s.io/zh/blog/2025/03/25/K3s-initialization"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="K3s initialization deep dive | K3s"><meta data-rh="true" name="description" content="Explain k3s initialization steps"><meta data-rh="true" property="og:description" content="Explain k3s initialization steps"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-03-25T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/manuelbuil"><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.k3s.io/zh/blog/2025/03/25/K3s-initialization"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/blog/2025/03/25/K3s-initialization" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/zh/blog/2025/03/25/K3s-initialization" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/ja/blog/2025/03/25/K3s-initialization" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/blog/2025/03/25/K3s-initialization" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://docs.k3s.io/zh/blog/2025/03/25/K3s-initialization","mainEntityOfPage":"https://docs.k3s.io/zh/blog/2025/03/25/K3s-initialization","url":"https://docs.k3s.io/zh/blog/2025/03/25/K3s-initialization","headline":"K3s initialization deep dive","name":"K3s initialization deep dive","description":"Explain k3s initialization steps","datePublished":"2025-03-25T00:00:00.000Z","author":{"@type":"Person","name":"Manuel Buil","description":"K3s maintainer","url":"https://github.com/manuelbuil","image":"https://github.com/manuelbuil.png"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://docs.k3s.io/zh/blog","name":"k3s blog"}}</script><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="K3s RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="K3s Atom Feed"><link rel="stylesheet" href="/zh/assets/css/styles.a3400111.css">
<script src="/zh/assets/js/runtime~main.8d5c3ef1.js" defer="defer"></script>
<script src="/zh/assets/js/main.3f8f86c1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/zh/img/k3s-logo-light.svg"><link rel="preload" as="image" href="/zh/img/k3s-logo-dark.svg"><link rel="preload" as="image" href="https://github.com/manuelbuil.png"><div role="region" aria-label="Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Ë∑≥Âà∞‰∏ªË¶ÅÂÜÖÂÆπ</a></div><nav aria-label="‰∏ªÂØºËà™" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/k3s-logo-light.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/k3s-logo-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="ÊêúÁ¥¢" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>ÁÆÄ‰Ωì‰∏≠Êñá</a><ul class="dropdown__menu"><li><a href="/blog/2025/03/25/K3s-initialization" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/blog/2025/03/25/K3s-initialization" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">ÁÆÄ‰Ωì‰∏≠Êñá</a></li><li><a href="/ja/blog/2025/03/25/K3s-initialization" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">Êó•Êú¨Ë™û</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__icon navbar__blog navbar__link--active" href="/zh/blog">Blog</a><a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon navbar__github">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="ÂàáÊç¢ÊµÖËâ≤/ÊöóÈªëÊ®°ÂºèÔºàÂΩìÂâç‰∏∫system modeÔºâ"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="ÊúÄËøëÂçöÊñáÂØºËà™"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/zh/blog/2025/03/25/K3s-initialization">K3s initialization deep dive</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/03/10/simple-ha">The Basic HA Cluster</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/zh/blog/2025/03/09/hello-blog">Hello Blog</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">K3s initialization deep dive</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-03-25T00:00:00.000Z">2025Âπ¥3Êúà25Êó•</time></div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/manuelbuil" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://github.com/manuelbuil.png" alt="Manuel Buil"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/manuelbuil" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Manuel Buil</span></a></div><small class="authorTitle_nd0D" title="K3s maintainer">K3s maintainer</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>K3s is a lightweight Kubernetes distribution which excels in its deployment speed and minimal resource footprint. In fact, a lot of our users love K3s because it offers an unparalleled initialization speed.</p>
<p>This blog post delves into the heart of K3s&#x27;s efficiency: its initialization process. We&#x27;ll embark on a journey through the steps that enable K3s to materialize a fully functional Kubernetes cluster so quickly. By examining K3s‚Äôs own logs, we&#x27;ll unravel the meaning behind each step, providing you with a practical understanding of how K3s achieves its remarkable speed. This exploration not only illuminates the inner workings of K3s but also equips you with the knowledge to troubleshoot your deployments.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-embedded-powerhouse-Ô∏è">The Embedded Powerhouse ‚öôÔ∏è‚ö°<a href="#the-embedded-powerhouse-Ô∏è" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<p>K3s leverages <code>go-bindata</code> to embed essential Linux userspace binaries and manifests directly into its executable. This eliminates external dependencies and streamlines the deployment process. Within the K3s binary, you&#x27;ll find core components like <code>runc</code> and <code>containerd</code>, along with the k3s-root tarball (e.g. k3s-root-amd64.tar). This tarball contains all the userspace binaries necessary for K3s to function, reducing the reliance on the host OS. If you would like all the K3s embedded binaries to take preference over the host OS binaries, you should use the <code>--prefer-bundled-bin</code> flag.</p>
<p>The embedded binaries are always deployed in the same directory: <code>/var/lib/rancher/k3s/data</code>. If you inspect this folder, you will notice it contains at least three subdirectories: <code>cni</code>, <code>current</code> and a long string of characters (or SHA). That long string of characters is generated when building K3s and it is the result of a <code>sha256sum</code> operation made on the tarball with the embedded binaries. As these change in each release, you will see a different string of characters for each release. In fact, after an upgrade, there will be two directories with a long string of characters as their name.</p>
<p><code>current</code> is just a symlink to the SHA directory and <code>cni</code> includes different cni plugins that are also symlinks to the cni binary in the SHA directory. This is because we are building all cni plugins in just one binary using multi-exec tooling. This is again a way to be more efficient and less resource consuming. If your current K3s deployment underwent an upgrade process, you will see one extra directory called <code>previous</code>, which is another symlink to the previous SHA directory. For clarification this example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$&gt; ls -ahltr /var/lib/rancher/k3s/data/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">total 24K</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-rw------- 1 root root    0 Mar 19 06:22 .lock</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x 4 root root 4.0K Mar 19 06:22 ..</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x 4 root root 4.0K Mar 19 06:28 82142f5157c67effc219aeefe0bc03e0460fc62b9fbae9e901270c86b5635d53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx 1 root root   90 Mar 19 06:28 previous -&gt; /var/lib/rancher/k3s/data/82142f5157c67effc219aeefe0bc03e0460fc62b9fbae9e901270c86b5635d53</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x 4 root root 4.0K Mar 19 06:30 b13851fe661ab93938fc9a881cdce529da8c6b9b310b2440ef01a860f8b9c3a9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">lrwxrwxrwx 1 root root   90 Mar 19 06:30 current -&gt; /var/lib/rancher/k3s/data/b13851fe661ab93938fc9a881cdce529da8c6b9b310b2440ef01a860f8b9c3a9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x 2 root root 4.0K Mar 19 06:30 cni</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxr-xr-x 4 root root 4.0K Mar 19 06:40 .</span><br></span></code></pre></div></div>
<p>Additionally, K3s includes embedded Helm charts and manifests for deploying critical services such as CoreDNS, Traefik, and local storage. These embedded charts, formatted as yaml files, can be found in the control plane nodes in the directory: <code>/var/lib/rancher/k3s/server/manifests</code>.</p>
<p>For 67MB our K3s binary includes a lot of stuff!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-boot-sequence-step-by-step-">The Boot Sequence, Step-by-Step üë£<a href="#the-boot-sequence-step-by-step-" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<p>Now that we established how K3s is carrying its embedded tools, we can explore the boot up sequence. Let us look at the typical logs you can find in <code>journalctl</code> when deploying a control-plane or K3s server instance. It all starts with:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Starting Lightweight Kubernetes...</span><br></span></code></pre></div></div>
<p>And then:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service</span><br></span></code></pre></div></div>
<p>This part is checking for a network manager utility which must be disabled as described in the <a href="https://docs.k3s.io/installation/requirements?_highlight=nm&amp;_highlight=cloud&amp;_highlight=setup.service&amp;os=rhel#operating-systems" target="_blank" rel="noopener noreferrer">docs</a>. It configures some parts of the network stack, specifically the routing tables, which conflict with Kubernetes networking, and that is why we verify if it was correctly disabled.</p>
<p>The next message should look familiar</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Acquiring lock file /var/lib/rancher/k3s/data/.lock</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Preparing data dir /var/lib/rancher/k3s/data/f8e9b5e7d85085972f4a9ddfd539d4dcf887be2e380a55f415c93cac5516dad5</span><br></span></code></pre></div></div>
<p>When this message is shown, the directory where K3s deploys the embedded binaries has already been created. At this point, K3s will extract the binaries. We use the lock to avoid concurrent modifications, preventing K3s embedded commands like <code>kubectl</code> or <code>ctr</code> from executing and disturbing the K3s initialization.</p>
<p>The next block of logs point at the K3s version and the datastore. In this case, I am using the default datastore which means kine with sqlite. For more information on the different datastores available check this <a href="https://docs.k3s.io/datastore" target="_blank" rel="noopener noreferrer">link</a></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Starting k3s v1.32.2+k3s1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Configuring sqlite3 database connection pooling: maxIdleConns=2, maxOpenConns=0, connMaxLifetime=0s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Configuring database table schema and indexes, this may take a moment...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Database tables and indexes are up to date</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Kine available at unix://kine.sock</span><br></span></code></pre></div></div>
<p>Once the datastore is available k3s locks the bootstrap key. This step is useful for HA mode and this this key is just a placeholder so that other control-plane nodes do not start generating new CA certs. As we are not using HA mode in this example, this is not relevant.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Bootstrap key locked for initial create</span><br></span></code></pre></div></div>
<p>K3s then generates all the TLS certificates required for the internal communications:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">generated self-signed CA certificate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=system:admin,O=system:masters signed by CN=k3s-client-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=system:k3s-supervisor,O=system:masters signed by CN=k3s-client-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=system:kube-controller-manager signed by CN=k3s-client-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=system:kube-scheduler signed by CN=k3s-client-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=system:apiserver,O=system:masters signed by CN=k3s-client-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=k3s-cloud-controller-manager signed by CN=k3s-client-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">generated self-signed CA certificate CN=k3s-server-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=kube-apiserver signed by CN=k3s-server-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">generated self-signed CA certificate CN=k3s-request-header-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=system:auth-proxy signed by CN=k3s-request-header-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">generated self-signed CA certificate CN=etcd-server-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=etcd-client signed by CN=etcd-server-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">generated self-signed CA certificate CN=etcd-peer-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=etcd-peer signed by CN=etcd-peer-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=etcd-server signed by CN=etcd-server-ca@1742309831</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">certificate CN=k3s,O=k3s signed by CN=k3s-server-ca@1742309831</span><br></span></code></pre></div></div>
<p>And then saves the bootstrap data in the bootstrap key. Again, this is not relevant for this example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Saving cluster bootstrap data to datastore</span><br></span></code></pre></div></div>
<p>After that, K3s starts the different Kubernetes components. These components are all run within the k3s process as goroutines, which are lightweight, concurrent functions in Go, allowing for efficient resource usage. This is another design decision taken to reduce boot time and reduce resource consumption.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running kube-apiserver</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running kube-scheduler</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Running kube-controller-manager</span><br></span></code></pre></div></div>
<p>Manifests for packaged components are extracted to <code>/var/lib/rancher/k3s/server/manifests/</code>. When all the different Kubernetes components are running and K3s initialization is ready, the deploy controller begins watching this directory and applies all the manifests. This is how components like CoreDNS or Traefik eventually get installed.</p>
<p>And that‚Äôs it, in a short period of time, you end up with a fully deployed and running Kubernetes distribution. üéâ</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion-">Conclusion üèÅ<a href="#conclusion-" class="hash-link" aria-label="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•" title="Ê†áÈ¢òÁöÑÁõ¥Êé•ÈìæÊé•">‚Äã</a></h2>
<p>This exploration has hopefully demystified some of the initial steps that enable K3s to materialize a fully functional Kubernetes cluster. By examining the logs, we&#x27;ve shed some light on the meaning behind each step, providing you with a deeper understanding of how K3s deploys in such a fast manner. We hope you find this knowledge useful to troubleshoot or at least to understand a bit deeper how K3s works.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ÂçöÊñáÂàÜÈ°µÂØºËà™"><a class="pagination-nav__link pagination-nav__link--next" href="/zh/blog/2025/03/10/simple-ha"><div class="pagination-nav__sublabel">ËæÉÊóß‰∏ÄÁØá</div><div class="pagination-nav__label">The Basic HA Cluster</div></a></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 K3s Project Authors. All rights reserved. <br>The Linux Foundation has registered trademarks
      and uses trademarks. For a list of trademarks of The Linux Foundation, 
      please see our <a href="https://www.linuxfoundation.org/trademark-usage"> Trademark Usage</a> page.</div></div></div></footer></div>
</body>
</html>