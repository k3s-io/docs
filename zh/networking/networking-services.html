<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-networking/networking-services" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Networking Services | K3s</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.k3s.io/zh/networking/networking-services"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Networking Services | K3s"><meta data-rh="true" name="description" content="This page explains how CoreDNS, Traefik Ingress controller, Network Policy controller, and ServiceLB load balancer controller work within K3s."><meta data-rh="true" property="og:description" content="This page explains how CoreDNS, Traefik Ingress controller, Network Policy controller, and ServiceLB load balancer controller work within K3s."><link data-rh="true" rel="icon" href="/zh/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.k3s.io/zh/networking/networking-services"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/networking/networking-services" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/zh/networking/networking-services" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/ja/networking/networking-services" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/networking/networking-services" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Networking","item":"https://docs.k3s.io/zh/networking/"},{"@type":"ListItem","position":2,"name":"Networking Services","item":"https://docs.k3s.io/zh/networking/networking-services"}]}</script><link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="K3s RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="K3s Atom Feed"><link rel="stylesheet" href="/zh/assets/css/styles.a3400111.css">
<script src="/zh/assets/js/runtime~main.ffd5f16d.js" defer="defer"></script>
<script src="/zh/assets/js/main.1265ad98.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/zh/img/k3s-logo-light.svg"><link rel="preload" as="image" href="/zh/img/k3s-logo-dark.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/k3s-logo-light.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh/img/k3s-logo-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/networking/networking-services" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/zh/networking/networking-services" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">简体中文</a></li><li><a href="/ja/networking/networking-services" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a class="navbar__item navbar__link navbar__icon navbar__blog" href="/zh/blog">Blog</a><a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__icon navbar__github">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/">K3s - 轻量级 Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/quick-start">快速入门指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/installation">安装</a><button aria-label="展开侧边栏分类 &#x27;安装&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/datastore">集群数据存储</a><button aria-label="展开侧边栏分类 &#x27;集群数据存储&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/upgrades">升级</a><button aria-label="展开侧边栏分类 &#x27;升级&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/security">安全</a><button aria-label="展开侧边栏分类 &#x27;安全&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/zh/cli">CLI 工具</a><button aria-label="展开侧边栏分类 &#x27;CLI 工具&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/architecture">架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/cluster-access">集群访问</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/storage">卷和存储</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/import-images">Import Images</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/zh/networking">Networking</a><button aria-label="折叠侧边栏分类 &#x27;Networking&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/networking/basic-network-options">Basic Network Options</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/networking/distributed-multicloud">Distributed hybrid or multicloud cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zh/networking/multus-ipams">Multus and IPAM plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zh/networking/networking-services">Networking Services</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/helm">Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/advanced">高级选项和配置</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh/reference/env-variables">参考</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/zh/release-notes/v1.33.X">Release Notes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/related-projects">Related Projects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/known-issues">已知问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh/faq">常见问题</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/zh/networking"><span>Networking</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Networking Services</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Networking Services</h1></header><p>This page explains how CoreDNS, Traefik Ingress controller, Network Policy controller, and ServiceLB load balancer controller work within K3s.</p>
<p>Refer to the <a href="/zh/networking/basic-network-options">Installation Network Options</a> page for details on Flannel configuration options and backend selection, or how to set up your own CNI.</p>
<p>For information on which ports need to be opened for K3s, refer to the <a href="/zh/installation/requirements#networking">Networking Requirements</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="coredns">CoreDNS<a href="#coredns" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>CoreDNS is deployed automatically on server startup. To disable it, configure all servers in the cluster with the <code>--disable=coredns</code> option.</p>
<p>If you don&#x27;t install CoreDNS, you will need to install a cluster DNS provider yourself.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="traefik-ingress-controller">Traefik Ingress Controller<a href="#traefik-ingress-controller" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p><a href="https://traefik.io/" target="_blank" rel="noopener noreferrer">Traefik</a> is a modern HTTP reverse proxy and load balancer made to deploy microservices with ease. It simplifies networking complexity while designing, deploying, and running applications.</p>
<p>The Traefik ingress controller deploys a LoadBalancer Service that uses ports 80 and 443. By default, ServiceLB will expose these ports on all cluster members, meaning these ports will not be usable for other HostPort or NodePort pods.</p>
<p>Traefik is deployed by default when starting the server. For more information see <a href="/zh/installation/packaged-components">Managing Packaged Components</a>. The default config file is found in <code>/var/lib/rancher/k3s/server/manifests/traefik.yaml</code>.</p>
<p>The <code>traefik.yaml</code> file should not be edited manually, as K3s will replace the file with defaults at startup. Instead, you should customize Traefik by creating an additional <code>HelmChartConfig</code> manifest in <code>/var/lib/rancher/k3s/server/manifests</code>. For more details and an example see <a href="/zh/helm#customizing-packaged-components-with-helmchartconfig">Customizing Packaged Components with HelmChartConfig</a>. For more information on the possible configuration values, refer to the official <a href="https://github.com/traefik/traefik-helm-chart/tree/master/traefik" target="_blank" rel="noopener noreferrer">Traefik Helm Configuration Parameters.</a>.</p>
<p>To remove Traefik from your cluster, start all servers with the <code>--disable=traefik</code> flag.</p>
<p>K3s versions 1.20 and earlier include Traefik v1. K3s versions 1.21 and later install Traefik v2, unless an existing installation of Traefik v1 is found, in which case Traefik is not upgraded to v2. For more information on the specific version of Traefik included with K3s, consult the Release Notes for your version.</p>
<p>To migrate from an older Traefik v1 instance please refer to the <a href="https://doc.traefik.io/traefik/migrate/v1-to-v2/" target="_blank" rel="noopener noreferrer">Traefik documentation</a> and <a href="https://github.com/traefik/traefik-migration-tool" target="_blank" rel="noopener noreferrer">migration tool</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-policy-controller">Network Policy Controller<a href="#network-policy-controller" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>K3s includes an embedded network policy controller. The underlying implementation is <a href="https://github.com/cloudnativelabs/kube-router" target="_blank" rel="noopener noreferrer">kube-router&#x27;s</a> netpol controller library (no other kube-router functionality is present) and can be found <a href="https://github.com/k3s-io/k3s/tree/master/pkg/agent/netpol" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>To disable it, start each server with the <code>--disable-network-policy</code> flag.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>Network policy iptables rules are not removed if the K3s configuration is changed to disable the network policy controller. To clean up the configured kube-router network policy rules after disabling the network policy controller, use the <code>k3s-killall.sh</code> script, or clean them using <code>iptables-save</code> and <code>iptables-restore</code>. These steps must be run manually on all nodes in the cluster.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">iptables-save | grep -v KUBE-ROUTER | iptables-restore</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ip6tables-save | grep -v KUBE-ROUTER | ip6tables-restore</span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-load-balancer">Service Load Balancer<a href="#service-load-balancer" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>Any LoadBalancer controller can be deployed to your K3s cluster. By default, K3s provides a load balancer known as <a href="https://github.com/k3s-io/klipper-lb" target="_blank" rel="noopener noreferrer">ServiceLB</a> (formerly Klipper LoadBalancer) that uses available host ports.</p>
<p>Upstream Kubernetes allows Services of type LoadBalancer to be created, but doesn&#x27;t include a default load balancer implementation, so these services will remain <code>pending</code> until one is installed. Many hosted services require a cloud provider such as Amazon EC2 or Microsoft Azure to offer an external load balancer implementation. By contrast, the K3s ServiceLB makes it possible to use LoadBalancer Services without a cloud provider or any additional configuration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-servicelb-works">How ServiceLB Works<a href="#how-servicelb-works" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p>The ServiceLB controller watches Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank" rel="noopener noreferrer">Services</a> with the <code>spec.type</code> field set to <code>LoadBalancer</code>.</p>
<p>For each LoadBalancer Service, a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/" target="_blank" rel="noopener noreferrer">DaemonSet</a> is created in the <code>kube-system</code> namespace. This DaemonSet in turn creates Pods with a <code>svc-</code> prefix, on each node. These Pods use iptables to forward traffic from the Pod&#x27;s NodePort, to the Service&#x27;s ClusterIP address and port.</p>
<p>If the ServiceLB Pod runs on a node that has an external IP configured, the node&#x27;s external IP is populated into the Service&#x27;s <code>status.loadBalancer.ingress</code> address list. Otherwise, the node&#x27;s internal IP is used.</p>
<p>If multiple LoadBalancer Services are created, a separate DaemonSet is created for each Service.</p>
<p>It is possible to expose multiple Services on the same node, as long as they use different ports.</p>
<p>If you try to create a LoadBalancer Service that listens on port 80, the ServiceLB will try to find a free host in the cluster for port 80. If no host with that port is available, the LB will remain Pending.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p>Create a <a href="https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer" target="_blank" rel="noopener noreferrer">Service of type LoadBalancer</a> in K3s.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="controlling-servicelb-node-selection">Controlling ServiceLB Node Selection<a href="#controlling-servicelb-node-selection" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p>Adding the <code>svccontroller.k3s.cattle.io/enablelb=true</code> label to one or more nodes switches the ServiceLB controller into allow-list mode, where only nodes with the label are eligible to host LoadBalancer pods. Nodes that remain unlabeled will be excluded from use by ServiceLB.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>By default, nodes are not labeled. As long as all nodes remain unlabeled, all nodes with ports available will be used by ServiceLB.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-servicelb-node-pools">Creating ServiceLB Node Pools<a href="#creating-servicelb-node-pools" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p>To select a particular subset of nodes to host pods for a LoadBalancer, add the <code>enablelb</code> label to the desired nodes, and set matching <code>lbpool</code> label values on the Nodes and Services. For example:</p>
<ol>
<li>Label Node A and Node B with <code>svccontroller.k3s.cattle.io/lbpool=pool1</code> and <code>svccontroller.k3s.cattle.io/enablelb=true</code></li>
<li>Label Node C and Node D with <code>svccontroller.k3s.cattle.io/lbpool=pool2</code> and <code>svccontroller.k3s.cattle.io/enablelb=true</code></li>
<li>Create one LoadBalancer Service on port 443 with label <code>svccontroller.k3s.cattle.io/lbpool=pool1</code>. The DaemonSet for this service only deploy Pods to Node A and Node B.</li>
<li>Create another LoadBalancer Service on port 443 with label <code>svccontroller.k3s.cattle.io/lbpool=pool2</code>. The DaemonSet will only deploy Pods to Node C and Node D.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disabling-servicelb">Disabling ServiceLB<a href="#disabling-servicelb" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h3>
<p>To disable ServiceLB, configure all servers in the cluster with the <code>--disable=servicelb</code> flag.</p>
<p>This is necessary if you wish to run a different LB, such as MetalLB.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-an-external-cloud-controller-manager">Deploying an External Cloud Controller Manager<a href="#deploying-an-external-cloud-controller-manager" class="hash-link" aria-label="标题的直接链接" title="标题的直接链接">​</a></h2>
<p>In order to reduce binary size, K3s removes all &quot;in-tree&quot; (built-in) cloud providers. Instead, K3s provides an embedded Cloud Controller Manager (CCM) stub that does the following:</p>
<ul>
<li>Sets node InternalIP and ExternalIP address fields based on the <code>--node-ip</code> and <code>--node-external-ip</code> flags.</li>
<li>Hosts the ServiceLB LoadBalancer controller.</li>
<li>Clears the <code>node.cloudprovider.kubernetes.io/uninitialized</code> taint that is present when the cloud-provider is set to <code>external</code></li>
</ul>
<p>Before deploying an external CCM, you must start all K3s servers with the <code>--disable-cloud-controller</code> flag to disable to embedded CCM.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>If you disable the built-in CCM and do not deploy and properly configure an external substitute, nodes will remain tainted and unschedulable.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/k3s-io/docs/edit/main/docs/networking/networking-services.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2025-07-30T19:33:05.000Z" itemprop="dateModified">2025年7月30日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/zh/networking/multus-ipams"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Multus and IPAM plugins</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zh/helm"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Helm</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#coredns" class="table-of-contents__link toc-highlight">CoreDNS</a></li><li><a href="#traefik-ingress-controller" class="table-of-contents__link toc-highlight">Traefik Ingress Controller</a></li><li><a href="#network-policy-controller" class="table-of-contents__link toc-highlight">Network Policy Controller</a></li><li><a href="#service-load-balancer" class="table-of-contents__link toc-highlight">Service Load Balancer</a><ul><li><a href="#how-servicelb-works" class="table-of-contents__link toc-highlight">How ServiceLB Works</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#controlling-servicelb-node-selection" class="table-of-contents__link toc-highlight">Controlling ServiceLB Node Selection</a></li><li><a href="#creating-servicelb-node-pools" class="table-of-contents__link toc-highlight">Creating ServiceLB Node Pools</a></li><li><a href="#disabling-servicelb" class="table-of-contents__link toc-highlight">Disabling ServiceLB</a></li></ul></li><li><a href="#deploying-an-external-cloud-controller-manager" class="table-of-contents__link toc-highlight">Deploying an External Cloud Controller Manager</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 K3s Project Authors. All rights reserved. <br>The Linux Foundation has registered trademarks
      and uses trademarks. For a list of trademarks of The Linux Foundation, 
      please see our <a href="https://www.linuxfoundation.org/trademark-usage"> Trademark Usage</a> page.</div></div></div></footer></div>
</body>
</html>