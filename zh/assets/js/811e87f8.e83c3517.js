"use strict";(self.webpackChunkk_3_s_docs=self.webpackChunkk_3_s_docs||[]).push([[143],{3905:function(e,n,r){r.d(n,{Zo:function(){return p},kt:function(){return d}});var t=r(7294);function a(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){a(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function i(e,n){if(null==e)return{};var r,t,a=function(e,n){if(null==e)return{};var r,t,a={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(a[r]=e[r]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=t.createContext({}),c=function(e){var n=t.useContext(o),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},p=function(e){var n=c(e.components);return t.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},k=t.forwardRef((function(e,n){var r=e.components,a=e.mdxType,s=e.originalType,o=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),k=c(r),d=a,m=k["".concat(o,".").concat(d)]||k[d]||u[d]||s;return r?t.createElement(m,l(l({ref:n},p),{},{components:r})):t.createElement(m,l({ref:n},p))}));function d(e,n){var r=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=r.length,l=new Array(s);l[0]=k;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var c=2;c<s;c++)l[c]=r[c];return t.createElement.apply(null,l)}return t.createElement.apply(null,r)}k.displayName="MDXCreateElement"},7223:function(e,n,r){r.r(n),r.d(n,{assets:function(){return p},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return u}});var t=r(3117),a=r(102),s=(r(7294),r(3905)),l=["components"],i={title:"CIS \u5f3a\u5316\u6307\u5357",weight:80},o=void 0,c={unversionedId:"security/hardening-guide",id:"security/hardening-guide",title:"CIS \u5f3a\u5316\u6307\u5357",description:"\u672c\u6587\u6863\u63d0\u4f9b\u4e86\u7528\u4e8e\u5f3a\u5316 K3s \u96c6\u7fa4\u751f\u4ea7\u5b89\u88c5\u7684\u8bf4\u660e\u3002\u6b64\u5904\u6982\u8ff0\u4e86\u4e3a\u89e3\u51b3 CIS Kubernetes Benchmark \u7ba1\u63a7\u6240\u9700\u7684\u914d\u7f6e\u548c\u63a7\u5236\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/current/security/hardening-guide.md",sourceDirName:"security",slug:"/security/hardening-guide",permalink:"/zh/security/hardening-guide",draft:!1,editUrl:"https://github.com/k3s-io/docs/edit/main/docs/security/hardening-guide.md",tags:[],version:"current",lastUpdatedAt:1671564981,formattedLastUpdatedAt:"2022\u5e7412\u670820\u65e5",frontMatter:{title:"CIS \u5f3a\u5316\u6307\u5357",weight:80},sidebar:"mySidebar",previous:{title:"Secret \u52a0\u5bc6",permalink:"/zh/security/secrets-encryption"},next:{title:"CIS Self Assessment Guide",permalink:"/zh/security/self-assessment"}},p={},u=[{value:"\u4e3b\u673a\u7ea7\u522b\u8981\u6c42",id:"\u4e3b\u673a\u7ea7\u522b\u8981\u6c42",level:2},{value:"\u786e\u4fdd\u8bbe\u7f6e\u4e86 <code>protect-kernel-defaults</code>",id:"\u786e\u4fdd\u8bbe\u7f6e\u4e86-protect-kernel-defaults",level:3},{value:"\u8bbe\u7f6e\u5185\u6838\u53c2\u6570",id:"\u8bbe\u7f6e\u5185\u6838\u53c2\u6570",level:4},{value:"Kubernetes \u8fd0\u884c\u65f6\u8981\u6c42",id:"kubernetes-\u8fd0\u884c\u65f6\u8981\u6c42",level:2},{value:"Pod \u5b89\u5168\u7b56\u7565",id:"pod-\u5b89\u5168\u7b56\u7565",level:3},{value:"NetworkPolicies",id:"networkpolicies",level:3},{value:"API Server \u5ba1\u8ba1\u914d\u7f6e",id:"api-server-\u5ba1\u8ba1\u914d\u7f6e",level:3},{value:"\u5df2\u77e5\u95ee\u9898",id:"\u5df2\u77e5\u95ee\u9898",level:2},{value:"\u7ba1\u63a7 1.2.15",id:"\u7ba1\u63a7-1215",level:3},{value:"\u7ba1\u63a7 1.2.16",id:"\u7ba1\u63a7-1216",level:3},{value:"\u7ba1\u63a7 1.2.22",id:"\u7ba1\u63a7-1222",level:3},{value:"\u7ba1\u63a7 1.2.23",id:"\u7ba1\u63a7-1223",level:3},{value:"\u7ba1\u63a7 1.2.24",id:"\u7ba1\u63a7-1224",level:3},{value:"\u7ba1\u63a7 1.2.25",id:"\u7ba1\u63a7-1225",level:3},{value:"\u7ba1\u63a7 1.2.26",id:"\u7ba1\u63a7-1226",level:3},{value:"\u7ba1\u63a7 1.2.27",id:"\u7ba1\u63a7-1227",level:3},{value:"\u7ba1\u63a7 1.2.33",id:"\u7ba1\u63a7-1233",level:3},{value:"\u7ba1\u63a7 1.2.34",id:"\u7ba1\u63a7-1234",level:3},{value:"\u7ba1\u63a7 1.3.1",id:"\u7ba1\u63a7-131",level:3},{value:"\u7ba1\u63a7 3.2.1",id:"\u7ba1\u63a7-321",level:3},{value:"\u7ba1\u63a7 4.2.7",id:"\u7ba1\u63a7-427",level:3},{value:"\u7ba1\u63a7 5.1.5",id:"\u7ba1\u63a7-515",level:3},{value:"Control Plane \u6267\u884c\u548c\u53c2\u6570",id:"control-plane-\u6267\u884c\u548c\u53c2\u6570",level:2},{value:"\u7ed3\u8bba",id:"\u7ed3\u8bba",level:2}],k={toc:u};function d(e){var n=e.components,r=(0,a.Z)(e,l);return(0,s.kt)("wrapper",(0,t.Z)({},k,r,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"\u672c\u6587\u6863\u63d0\u4f9b\u4e86\u7528\u4e8e\u5f3a\u5316 K3s \u96c6\u7fa4\u751f\u4ea7\u5b89\u88c5\u7684\u8bf4\u660e\u3002\u6b64\u5904\u6982\u8ff0\u4e86\u4e3a\u89e3\u51b3 CIS Kubernetes Benchmark \u7ba1\u63a7\u6240\u9700\u7684\u914d\u7f6e\u548c\u63a7\u5236\u3002"),(0,s.kt)("p",null,"K3s \u9ed8\u8ba4\u5e94\u7528\u5e76\u542f\u7528\u4e86\u8bb8\u591a\u5b89\u5168\u7f13\u89e3\u63aa\u65bd\uff0c\u65e0\u9700\u4fee\u6539\u5373\u53ef\u901a\u8fc7\u8bb8\u591a Kubernetes CIS \u7ba1\u63a7\u3002\u4f46\u662f\u4e5f\u6709\u4e00\u4e9b\u4f8b\u5916\u60c5\u51b5\u662f\u9700\u8981\u4eba\u5de5\u5e72\u9884\u624d\u80fd\u5b8c\u5168\u901a\u8fc7 CIS Benchmark\uff1a"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"K3s \u4e0d\u4f1a\u4fee\u6539\u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u3002\u4efb\u4f55\u4e3b\u673a\u7ea7\u522b\u7684\u4fee\u6539\u90fd\u9700\u8981\u624b\u52a8\u5b8c\u6210\u3002"),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("inlineCode",{parentName:"li"},"PodSecurityPolicies")," \u548c ",(0,s.kt)("inlineCode",{parentName:"li"},"NetworkPolicies")," \u7684\u67d0\u4e9b CIS \u7b56\u7565\u4f1a\u9650\u5236\u96c6\u7fa4\u529f\u80fd\u3002\u4f60\u5fc5\u987b\u5728\u547d\u4ee4\u884c\u6807\u5fd7\u6216\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u9002\u5f53\u7684\u9009\u9879\uff08\u542f\u7528\u51c6\u5165\u63d2\u4ef6\uff09\u4ee5\u53ca\u624b\u52a8\u5e94\u7528\u7b56\u7565\uff0cK3s \u624d\u80fd\u914d\u7f6e\u8fd9\u5b83\u4eec\u3002\u4ee5\u4e0b\u5404\u8282\u5c06\u4ecb\u7ecd\u66f4\u591a\u8be6\u7ec6\u7684\u4fe1\u606f\u3002")),(0,s.kt)("p",null,"CIS Benchmark \u7684\u7b2c\u4e00\u90e8\u5206 (1.1) \u4e3b\u8981\u5173\u6ce8 Pod \u6e05\u5355\u6743\u9650\u548c\u6240\u6709\u6743\u3002K3s \u6ca1\u6709\u5c06\u5b83\u4eec\u7528\u4e8e\u6838\u5fc3\u7ec4\u4ef6\uff0c\u56e0\u4e3a\u6240\u6709\u5185\u5bb9\u90fd\u6253\u5305\u6210\u4e86\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002"),(0,s.kt)("h2",{id:"\u4e3b\u673a\u7ea7\u522b\u8981\u6c42"},"\u4e3b\u673a\u7ea7\u522b\u8981\u6c42"),(0,s.kt)("p",null,"\u4e3b\u673a\u7ea7\u522b\u7684\u8981\u6c42\u6709\u4e24\u4e2a\u65b9\u9762\uff0c\u5206\u522b\u662f\u5185\u6838\u53c2\u6570\u548c etcd \u8fdb\u7a0b/\u76ee\u5f55\u914d\u7f6e\u3002\u672c\u8282\u4f1a\u6982\u8ff0\u8fd9\u4e9b\u5185\u5bb9\u3002"),(0,s.kt)("h3",{id:"\u786e\u4fdd\u8bbe\u7f6e\u4e86-protect-kernel-defaults"},"\u786e\u4fdd\u8bbe\u7f6e\u4e86 ",(0,s.kt)("inlineCode",{parentName:"h3"},"protect-kernel-defaults")),(0,s.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a kubelet \u6807\u5fd7\uff0c\u5982\u679c\u6240\u9700\u7684\u5185\u6838\u53c2\u6570\u672a\u8bbe\u7f6e\u6216\u8bbe\u7f6e\u4e3a\u4e0e kubelet \u9ed8\u8ba4\u503c\u4e0d\u540c\u7684\u503c\uff0c\u5b83\u4f1a\u5bfc\u81f4 kubelet \u9000\u51fa\u3002"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a",(0,s.kt)("inlineCode",{parentName:"p"},"protect-kernel-defaults")," \u4f5c\u4e3a K3s \u7684\u9876\u5c42\u6807\u5fd7\u516c\u5f00\u3002")),(0,s.kt)("h4",{id:"\u8bbe\u7f6e\u5185\u6838\u53c2\u6570"},"\u8bbe\u7f6e\u5185\u6838\u53c2\u6570"),(0,s.kt)("p",null,"\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"/etc/sysctl.d/90-kubelet.conf")," \u7684\u6587\u4ef6\u5e76\u6dfb\u52a0\u4e0b\u9762\u7684\u4ee3\u7801\u7247\u6bb5\u3002\u7136\u540e\u8fd0\u884c ",(0,s.kt)("inlineCode",{parentName:"p"},"sysctl -p /etc/sysctl.d/90-kubelet.conf"),"\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"vm.panic_on_oom=0\nvm.overcommit_memory=1\nkernel.panic=10\nkernel.panic_on_oops=1\nkernel.keys.root_maxbytes=25000000\n")),(0,s.kt)("h2",{id:"kubernetes-\u8fd0\u884c\u65f6\u8981\u6c42"},"Kubernetes \u8fd0\u884c\u65f6\u8981\u6c42"),(0,s.kt)("p",null,"\u8981\u7b26\u5408 CIS Benchmark \u7684\u8fd0\u884c\u65f6\u8981\u6c42\uff0c\u5219\u9700\u8981\u4ee5 pod \u5b89\u5168\u6027 (PSP)\u3001\u7f51\u7edc\u7b56\u7565\u548c \u200b\u200bAPI Server \u5ba1\u8ba1\u65e5\u5fd7\u4e3a\u4e2d\u5fc3\u3002\u672c\u8282\u4f1a\u6982\u8ff0\u8fd9\u4e9b\u5185\u5bb9\u3002K3s \u4e0d\u4f1a\u5e94\u7528\u4efb\u4f55\u9ed8\u8ba4\u7684 PSP \u6216\u7f51\u7edc\u7b56\u7565\u3002\u7136\u800c\uff0cK3s \u9644\u5e26\u4e86\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u7528\u4e8e\u5e94\u7528\u4e00\u7ec4\u7ed9\u5b9a\u7684\u7f51\u7edc\u7b56\u7565\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cK3s \u4f7f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"NodeRestriction")," \u51c6\u5165\u63a7\u5236\u5668\u8fd0\u884c\u3002\u8981\u542f\u7528 PSP\uff0c\u8bf7\u5c06\u4ee5\u4e0b\u5185\u5bb9\u6dfb\u52a0\u5230 K3s \u542f\u52a8\u547d\u4ee4\uff1a",(0,s.kt)("inlineCode",{parentName:"p"},'--kube-apiserver-arg="enable-admission-plugins=NodeRestriction,PodSecurityPolicy,ServiceAccount"'),"\u3002\u8fd9\u5c06\u80fd\u7ef4\u62a4 ",(0,s.kt)("inlineCode",{parentName:"p"},"NodeRestriction")," \u63d2\u4ef6\u4ee5\u53ca\u542f\u7528 ",(0,s.kt)("inlineCode",{parentName:"p"},"PodSecurityPolicy"),"\u3002API Server \u5ba1\u8ba1\u65e5\u5fd7\u4e5f\u662f\u5982\u6b64\uff0cK3s \u9ed8\u8ba4\u4e0d\u542f\u7528\u5b83\u4eec\uff0c\u56e0\u6b64\u4f60\u5fc5\u987b\u624b\u52a8\u521b\u5efa\u5ba1\u8ba1\u65e5\u5fd7\u914d\u7f6e\u548c\u5ba1\u8ba1\u7b56\u7565\u3002"),(0,s.kt)("h3",{id:"pod-\u5b89\u5168\u7b56\u7565"},"Pod \u5b89\u5168\u7b56\u7565"),(0,s.kt)("p",null,"\u542f\u7528 PSP \u540e\u53ef\u4ee5\u5e94\u7528\u7b56\u7565\uff0c\u4ece\u800c\u6ee1\u8db3 CIS Benchmark \u7b2c 5.2 \u8282\u4e2d\u63cf\u8ff0\u7684\u5fc5\u8981\u7ba1\u63a7\u3002"),(0,s.kt)("p",null,"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b26\u5408\u8981\u6c42\u7684 PSP \u793a\u4f8b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: restricted-psp\nspec:\n  privileged: false                # CIS - 5.2.1\n  allowPrivilegeEscalation: false  # CIS - 5.2.5\n  requiredDropCapabilities:        # CIS - 5.2.7/8/9\n    - ALL\n  volumes:\n    - 'configMap'\n    - 'emptyDir'\n    - 'projected'\n    - 'secret'\n    - 'downwardAPI'\n    - 'csi'\n    - 'persistentVolumeClaim'\n    - 'ephemeral'\n  hostNetwork: false               # CIS - 5.2.4\n  hostIPC: false                   # CIS - 5.2.3\n  hostPID: false                   # CIS - 5.2.2\n  runAsUser:\n    rule: 'MustRunAsNonRoot'       # CIS - 5.2.6\n  seLinux:\n    rule: 'RunAsAny'\n  supplementalGroups:\n    rule: 'MustRunAs'\n    ranges:\n      - min: 1\n        max: 65535\n  fsGroup:\n    rule: 'MustRunAs'\n    ranges:\n      - min: 1\n        max: 65535\n  readOnlyRootFilesystem: false\n")),(0,s.kt)("p",null,"\u8981\u4f7f\u4e0a\u8ff0 PSP \u751f\u6548\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u4e2a ClusterRole \u548c\u4e00\u4e2a ClusterRoleBinding\u3002\u6b64\u5916\uff0c\u8fd8\u9700\u8981\u5305\u62ec\u4e00\u4e2a\u201c\u4e0d\u53d7\u7cfb\u7edf\u9650\u5236\u7684\u7b56\u7565\u201d\uff08\u7528\u4e8e\u9700\u8981\u989d\u5916\u6743\u9650\u7684\u7cfb\u7edf\u7ea7 pod\uff09\u4ee5\u53ca\u4e00\u4e2a servicelb \u6b63\u5e38\u8fd0\u884c\u6240\u9700\u7684 sysctls \u7b56\u7565\u3002"),(0,s.kt)("p",null,"\u4e0a\u9762\u7684 PSP yaml \u548c\u4e0b\u9762\u7684 NetworkPolicy yaml \u53ef\u4ee5\u7ec4\u5408\u6210\u4e00\u4e2a\u6587\u4ef6\uff0c\u653e\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"/var/lib/rancher/k3s/server/manifests")," \u76ee\u5f55\u4e2d\u3002\u4ee5\u4e0b\u662f ",(0,s.kt)("inlineCode",{parentName:"p"},"policy.yaml")," \u6587\u4ef6\u7684\u793a\u4f8b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: restricted-psp\nspec:\n  privileged: false\n  allowPrivilegeEscalation: false\n  requiredDropCapabilities:\n    - ALL\n  volumes:\n    - 'configMap'\n    - 'emptyDir'\n    - 'projected'\n    - 'secret'\n    - 'downwardAPI'\n    - 'csi'\n    - 'persistentVolumeClaim'\n    - 'ephemeral'\n  hostNetwork: false\n  hostIPC: false\n  hostPID: false\n  runAsUser:\n    rule: 'MustRunAsNonRoot'\n  seLinux:\n    rule: 'RunAsAny'\n  supplementalGroups:\n    rule: 'MustRunAs'\n    ranges:\n      - min: 1\n        max: 65535\n  fsGroup:\n    rule: 'MustRunAs'\n    ranges:\n      - min: 1\n        max: 65535\n  readOnlyRootFilesystem: false\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: system-unrestricted-psp\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: '*'\nspec:\n  allowPrivilegeEscalation: true\n  allowedCapabilities:\n  - '*'\n  fsGroup:\n    rule: RunAsAny\n  hostIPC: true\n  hostNetwork: true\n  hostPID: true\n  hostPorts:\n  - max: 65535\n    min: 0\n  privileged: true\n  runAsUser:\n    rule: RunAsAny\n  seLinux:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n  volumes:\n  - '*'\n---\napiVersion: policy/v1beta1\nkind: PodSecurityPolicy\nmetadata:\n  name: svclb-psp\n  annotations:\n    seccomp.security.alpha.kubernetes.io/allowedProfileNames: '*'\nspec:\n  allowPrivilegeEscalation: false\n  allowedCapabilities:\n  - NET_ADMIN\n  allowedUnsafeSysctls:\n  - net.ipv4.ip_forward\n  - net.ipv6.conf.all.forwarding\n  fsGroup:\n    rule: RunAsAny\n  hostPorts:\n  - max: 65535\n    min: 0\n  runAsUser:\n    rule: RunAsAny\n  seLinux:\n    rule: RunAsAny\n  supplementalGroups:\n    rule: RunAsAny\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: psp:restricted-psp\nrules:\n- apiGroups:\n  - policy\n  resources:\n  - podsecuritypolicies\n  verbs:\n  - use\n  resourceNames:\n  - restricted-psp\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: psp:system-unrestricted-psp\nrules:\n- apiGroups:\n  - policy\n  resources:\n  - podsecuritypolicies\n  resourceNames:\n  - system-unrestricted-psp\n  verbs:\n  - use\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: psp:svclb-psp\nrules:\n- apiGroups:\n  - policy\n  resources:\n  - podsecuritypolicies\n  resourceNames:\n  - svclb-psp\n  verbs:\n  - use\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: default:restricted-psp\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: psp:restricted-psp\nsubjects:\n- kind: Group\n  name: system:authenticated\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system-unrestricted-node-psp-rolebinding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: psp:system-unrestricted-psp\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:nodes\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: system-unrestricted-svc-acct-psp-rolebinding\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: psp:system-unrestricted-psp\nsubjects:\n- apiGroup: rbac.authorization.k8s.io\n  kind: Group\n  name: system:serviceaccounts\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: svclb-psp-rolebinding\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: psp:svclb-psp\nsubjects:\n- kind: ServiceAccount\n  name: svclb\n---\nkind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\n  name: intra-namespace\n  namespace: kube-system\nspec:\n  podSelector: {}\n  ingress:\n    - from:\n      - namespaceSelector:\n          matchLabels:\n            name: kube-system\n---\nkind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\n  name: intra-namespace\n  namespace: default\nspec:\n  podSelector: {}\n  ingress:\n    - from:\n      - namespaceSelector:\n          matchLabels:\n            name: default\n---\nkind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\n  name: intra-namespace\n  namespace: kube-public\nspec:\n  podSelector: {}\n  ingress:\n    - from:\n      - namespaceSelector:\n          matchLabels:\n            name: kube-public\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1aCNI\u3001DNS \u548c Ingress \u7b49 Kubernetes \u5173\u952e\u6dfb\u52a0\u9879\u4f1a\u5728 ",(0,s.kt)("inlineCode",{parentName:"p"},"kube-system")," \u547d\u540d\u7a7a\u95f4\u4e2d\u4f5c\u4e3a pod \u8fd0\u884c\u3002\u56e0\u6b64\uff0c\u6b64\u547d\u540d\u7a7a\u95f4\u7684\u7b56\u7565\u9650\u5236\u4f1a\u66f4\u4f4e\uff0c\u4ee5\u4fbf\u8fd9\u4e9b\u7ec4\u4ef6\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002")),(0,s.kt)("h3",{id:"networkpolicies"},"NetworkPolicies"),(0,s.kt)("p",null,"CIS \u8981\u6c42\u6240\u6709\u547d\u540d\u7a7a\u95f4\u90fd\u5e94\u7528\u7f51\u7edc\u7b56\u7565\uff0c\u4ece\u800c\u5408\u7406\u9650\u5236\u8fdb\u5165\u547d\u540d\u7a7a\u95f4\u548c pod \u7684\u6d41\u91cf\u3002"),(0,s.kt)("p",null,"\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b26\u5408\u8981\u6c42\u7684\u7f51\u7edc\u7b56\u7565\u793a\u4f8b\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"kind: NetworkPolicy\napiVersion: networking.k8s.io/v1\nmetadata:\n  name: intra-namespace\n  namespace: kube-system\nspec:\n  podSelector: {}\n  ingress:\n    - from:\n      - namespaceSelector:\n          matchLabels:\n            name: kube-system\n")),(0,s.kt)("p",null,"\u5e94\u7528\u9650\u5236\u540e\uff0c\u9664\u975e\u6709\u989d\u5916\u5141\u8bb8\uff0c\u5426\u5219 DNS \u5c06\u88ab\u963b\u6b62\u3002\u4ee5\u4e0b\u662f\u5141\u8bb8 DNS \u6d41\u91cf\u5b58\u5728\u7684\u7f51\u7edc\u7b56\u7565\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: default-network-dns-policy\n  namespace: <NAMESPACE>\nspec:\n  ingress:\n  - ports:\n    - port: 53\n      protocol: TCP\n    - port: 53\n      protocol: UDP\n  podSelector:\n    matchLabels:\n      k8s-app: kube-dns\n  policyTypes:\n  - Ingress\n")),(0,s.kt)("p",null,"\u5982\u679c\u672a\u521b\u5efa\u5141\u8bb8\u8bbf\u95ee\u7684\u7f51\u7edc\u7b56\u7565\uff0cmetrics-server \u548c Traefik ingress controller \u5c06\u88ab\u9ed8\u8ba4\u963b\u6b62\u3002K3s 1.20 \u53ca\u4ee5\u4e0b\u7248\u672c\u4e2d\u6253\u5305\u7684 Traefik v1 \u4f7f\u7528\u7684\u6807\u7b7e\u4e0e Traefik v2 \u4e0d\u540c\u3002\u8bf7\u786e\u4fdd\u4f60\u53ea\u4f7f\u7528\u4e86\u4e0e\u96c6\u7fa4\u4e0a\u7684 Traefik \u7248\u672c\u76f8\u5173\u8054\u7684\u4ee5\u4e0b YAML \u793a\u4f8b\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-all-metrics-server\n  namespace: kube-system\nspec:\n  podSelector:\n    matchLabels:\n      k8s-app: metrics-server\n  ingress:\n  - {}\n  policyTypes:\n  - Ingress\n---\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-all-svclbtraefik-ingress\n  namespace: kube-system\nspec:\n  podSelector:\n    matchLabels:\n      svccontroller.k3s.cattle.io/svcname: traefik\n  ingress:\n  - {}\n  policyTypes:\n  - Ingress\n---\n# Below is for 1.20 ONLY -- remove if on 1.21 or above\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-all-traefik-v120-ingress\n  namespace: kube-system\nspec:\n  podSelector:\n    matchLabels:\n      app: traefik\n  ingress:\n  - {}\n  policyTypes:\n  - Ingress\n---\n# Below is for 1.21 and above ONLY -- remove if on 1.20 or below\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: allow-all-traefik-v121-ingress\n  namespace: kube-system\nspec:\n  podSelector:\n    matchLabels:\n      app.kubernetes.io/name: traefik\n  ingress:\n  - {}\n  policyTypes:\n  - Ingress\n")),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},(0,s.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a\u64cd\u4f5c\u4eba\u5458\u9700\u8981\u7167\u5e38\u7ba1\u7406\u5176\u4ed6\u547d\u540d\u7a7a\u95f4\u7684\u7f51\u7edc\u7b56\u7565\u3002")),(0,s.kt)("h3",{id:"api-server-\u5ba1\u8ba1\u914d\u7f6e"},"API Server \u5ba1\u8ba1\u914d\u7f6e"),(0,s.kt)("p",null,"CIS 1.2.22 \u5230 1.2.25 \u8981\u6c42\u4e3a API Server \u914d\u7f6e\u5ba1\u8ba1\u65e5\u5fd7\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cK3s \u4e0d\u4f1a\u521b\u5efa\u65e5\u5fd7\u76ee\u5f55\u548c\u5ba1\u8ba1\u7b56\u7565\uff0c\u56e0\u4e3a\u5ba1\u8ba1\u8981\u6c42\u662f\u53d6\u51b3\u4e8e\u6bcf\u4e2a\u7528\u6237\u7684\u7b56\u7565\u548c\u73af\u5883\u7684\u3002"),(0,s.kt)("p",null,"\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u5fc5\u987b\u5728\u542f\u52a8 K3s \u4e4b\u524d\u521b\u5efa\u65e5\u5fd7\u76ee\u5f55\u3002\u5efa\u8bae\u4f7f\u7528\u9650\u5236\u6027\u8bbf\u95ee\u6743\u9650\uff0c\u907f\u514d\u6cc4\u9732\u654f\u611f\u4fe1\u606f\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir -p -m 700 /var/lib/rancher/k3s/server/logs\n")),(0,s.kt)("p",null,"\u4ee5\u4e0b\u662f\u7528\u4e8e\u8bb0\u5f55\u8bf7\u6c42\u5143\u6570\u636e\u7684\u521d\u59cb\u5ba1\u6838\u7b56\u7565\u3002\u7b56\u7565\u9700\u8981\u5199\u5165\u5230 ",(0,s.kt)("inlineCode",{parentName:"p"},"/var/lib/rancher/k3s/server")," \u76ee\u5f55\u4e2d\u540d\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"audit.yaml")," \u7684\u6587\u4ef6\u3002\u6709\u5173 API Server \u7b56\u7565\u914d\u7f6e\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 ",(0,s.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/debug-application-cluster/audit/"},"Kubernetes \u6587\u6863"),"\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: audit.k8s.io/v1\nkind: Policy\nrules:\n- level: Metadata\n")),(0,s.kt)("p",null,"\u4e24\u79cd\u914d\u7f6e\u90fd\u5fc5\u987b\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 API Server\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"--kube-apiserver-arg='audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log'\n--kube-apiserver-arg='audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml'\n")),(0,s.kt)("p",null,"\u5982\u679c\u914d\u7f6e\u662f\u5728\u5b89\u88c5 K3s \u4e4b\u540e\u521b\u5efa\u7684\uff0c\u5219\u5fc5\u987b\u5c06\u5b83\u4eec\u6dfb\u52a0\u5230 ",(0,s.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/k3s.service")," \u4e2d\u7684 K3s systemd \u670d\u52a1\u4e2d\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"ExecStart=/usr/local/bin/k3s \\\n    server \\\n    '--kube-apiserver-arg=audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log' \\\n    '--kube-apiserver-arg=audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml' \\\n")),(0,s.kt)("p",null,"\u5fc5\u987b\u91cd\u542f K3s \u624d\u80fd\u52a0\u8f7d\u65b0\u914d\u7f6e\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl daemon-reload\nsudo systemctl restart k3s.service\n")),(0,s.kt)("p",null,"\u4e0b\u9762\u4ecb\u7ecd\u4e86 CIS 1.2.22 \u5230 1.2.25 \u8981\u6c42\u7684\u5176\u4ed6\u4fe1\u606f\u3002"),(0,s.kt)("h2",{id:"\u5df2\u77e5\u95ee\u9898"},"\u5df2\u77e5\u95ee\u9898"),(0,s.kt)("p",null,"\u4ee5\u4e0b\u662f K3s \u76ee\u524d\u9ed8\u8ba4\u6ca1\u6709\u901a\u8fc7\u7684\u7ba1\u63a7\u3002\u6b64\u5904\u5c06\u89e3\u91ca\u5404\u4e2a\u5dee\u8ddd\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u5dee\u8ddd\u662f\u5426\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8\u5e72\u9884\u6216\u5728\u672a\u6765\u7684 K3s \u7248\u672c\u4e2d\u89e3\u51b3\u3002"),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1215"},"\u7ba1\u63a7 1.2.15"),(0,s.kt)("p",null,"\u786e\u4fdd\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 ",(0,s.kt)("inlineCode",{parentName:"p"},"NamespaceLifecycle")," \u5df2\u8bbe\u7f6e\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u5c06\u51c6\u5165\u63a7\u5236\u7b56\u7565\u8bbe\u7f6e\u4e3a NamespaceLifecycle \u53ef\u4ee5\u786e\u4fdd\u65e0\u6cd5\u5728\u4e0d\u5b58\u5728\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u521b\u5efa\u5bf9\u8c61\uff0c\u800c\u4e14\u6b63\u5728\u7ec8\u6b62\u7684\u547d\u540d\u7a7a\u95f4\u4e0d\u4f1a\u7528\u4e8e\u521b\u5efa\u65b0\u5bf9\u8c61\u3002\u8fd9\u662f\u6211\u4eec\u5efa\u8bae\u7684\u64cd\u4f5c\uff0c\u80fd\u786e\u4fdd\u547d\u540d\u7a7a\u95f4\u7ec8\u6b62\u8fc7\u7a0b\u7684\u5b8c\u6574\u6027\u4ee5\u53ca\u66f4\u65b0\u5bf9\u8c61\u7684\u53ef\u7528\u6027\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"enable-admission-plugins="),"\uff0c\u7136\u540e\u518d\u5c06\u5176\u4f20\u9012\u7ed9  ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1216"},"\u7ba1\u63a7 1.2.16"),(0,s.kt)("p",null,"\u786e\u4fdd\u51c6\u5165\u63a7\u5236\u63d2\u4ef6 ",(0,s.kt)("inlineCode",{parentName:"p"},"PodSecurityPolicy")," \u5df2\u8bbe\u7f6e\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"Pod \u5b89\u5168\u7b56\u7565\u662f\u96c6\u7fa4\u7ea7\u8d44\u6e90\uff0c\u5b83\u63a7\u5236 Pod \u53ef\u4ee5\u6267\u884c\u7684\u64cd\u4f5c\u4ee5\u53ca\u5b83\u53ef\u4ee5\u8bbf\u95ee\u7684\u5185\u5bb9\u3002`PodSecurityPolicy` \u5bf9\u8c61\u5b9a\u4e49\u4e86\u4e00\u7ec4\u6761\u4ef6\uff0c\u4e00\u4e2a pod \u5fc5\u987b\u6ee1\u8db3\u8fd9\u4e9b\u6761\u4ef6\u624d\u80fd\u88ab\u7cfb\u7edf\u63a5\u53d7\u3002Pod \u5b89\u5168\u7b56\u7565\u7531\u63a7\u5236 Pod \u6709\u6743\u8bbf\u95ee\u7684\u5b89\u5168\u529f\u80fd\u8bbe\u7f6e\u548c\u7b56\u7565\u7ec4\u6210\uff0c\u56e0\u6b64\u5fc5\u987b\u7528\u6765\u63a7\u5236 Pod \u8bbf\u95ee\u6743\u9650\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"enable-admission-plugins="),"\uff0c\u7136\u540e\u518d\u5c06\u5176\u4f20\u9012\u7ed9  ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1222"},"\u7ba1\u63a7 1.2.22"),(0,s.kt)("p",null,"\u786e\u4fdd\u8bbe\u7f6e\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"--audit-log-path")," \u53c2\u6570\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u5ba1\u8ba1 Kubernetes API Server \u63d0\u4f9b\u4e86\u4e00\u7ec4\u4e0e\u5b89\u5168\u76f8\u5173\u7684\uff0c\u6309\u65f6\u95f4\u987a\u5e8f\u6392\u5217\u7684\u8bb0\u5f55\uff0c\u8bb0\u5f55\u4e86\u5355\u4e2a\u7528\u6237\u3001\u7ba1\u7406\u5458\u6216\u7cfb\u7edf\u5176\u4ed6\u7ec4\u4ef6\u5bf9\u7cfb\u7edf\u9020\u6210\u5f71\u54cd\u7684\u6d3b\u52a8\u5e8f\u5217\u3002\u867d\u7136\u76ee\u524d Kubernetes \u4ec5\u63d0\u4f9b\u57fa\u672c\u7684\u5ba1\u8ba1\u529f\u80fd\uff0c\u4f46\u4f60\u8fd8\u662f\u5e94\u8be5\u542f\u7528\u5b83\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u9002\u5f53\u7684\u5ba1\u8ba1\u65e5\u5fd7\u8def\u5f84\u6765\u542f\u7528\u5b83\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1223"},"\u7ba1\u63a7 1.2.23"),(0,s.kt)("p",null,"\u786e\u4fdd\u5c06 ",(0,s.kt)("inlineCode",{parentName:"p"},"--audit-log-maxage")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 30 \u6216\u9002\u5f53\u7684\u503c\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u5c06\u65e5\u5fd7\u4fdd\u7559\u81f3\u5c11 30 \u5929\u53ef\u4ee5\u786e\u4fdd\u4f60\u80fd\u53ca\u65f6\u8c03\u67e5\u6216\u5173\u8054\u4efb\u4f55\u4e8b\u4ef6\u3002\u5c06\u5ba1\u8ba1\u65e5\u5fd7\u4fdd\u7559\u671f\u8bbe\u7f6e\u4e3a 30 \u5929\uff0c\u6216\u6839\u636e\u4f60\u7684\u4e1a\u52a1\u8981\u6c42\u8fdb\u884c\u8bbe\u7f6e\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1224"},"\u7ba1\u63a7 1.2.24"),(0,s.kt)("p",null,"\u786e\u4fdd\u5c06 ",(0,s.kt)("inlineCode",{parentName:"p"},"--audit-log-maxbackup")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u6216\u9002\u5f53\u7684\u503c\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"Kubernetes \u4f1a\u81ea\u52a8\u8f6e\u6362\u65e5\u5fd7\u6587\u4ef6\u3002\u4fdd\u7559\u65e7\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u786e\u4fdd\u4f60\u6709\u8db3\u591f\u7684\u65e5\u5fd7\u6570\u636e\u6765\u6267\u884c\u8c03\u67e5\u6216\u5173\u8054\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u5df2\u5c06\u6587\u4ef6\u5927\u5c0f\u8bbe\u7f6e\u4e3a 100 MB \u5e76\u5c06\u8981\u4fdd\u7559\u7684\u65e7\u65e5\u5fd7\u6587\u4ef6\u6570\u8bbe\u7f6e\u4e3a 10\uff0c\u90a3\u4e48\u4f60\u5c06\u6709\u5927\u7ea6 1 GB \u7684\u65e5\u5fd7\u6570\u636e\u7528\u4e8e\u5206\u6790\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1225"},"\u7ba1\u63a7 1.2.25"),(0,s.kt)("p",null,"\u786e\u4fdd\u5c06 ",(0,s.kt)("inlineCode",{parentName:"p"},"--audit-log-maxsize")," \u53c2\u6570\u8bbe\u7f6e\u4e3a 100 \u6216\u9002\u5f53\u7684\u503c\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"Kubernetes \u4f1a\u81ea\u52a8\u8f6e\u6362\u65e5\u5fd7\u6587\u4ef6\u3002\u4fdd\u7559\u65e7\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u786e\u4fdd\u4f60\u6709\u8db3\u591f\u7684\u65e5\u5fd7\u6570\u636e\u6765\u6267\u884c\u8c03\u67e5\u6216\u5173\u8054\u3002\u5982\u679c\u4f60\u5df2\u5c06\u6587\u4ef6\u5927\u5c0f\u8bbe\u7f6e\u4e3a 100 MB \u5e76\u5c06\u8981\u4fdd\u7559\u7684\u65e7\u65e5\u5fd7\u6587\u4ef6\u6570\u8bbe\u7f6e\u4e3a 10\uff0c\u90a3\u4e48\u4f60\u5c06\u6709\u5927\u7ea6 1 GB \u7684\u65e5\u5fd7\u6570\u636e\u7528\u4e8e\u5206\u6790\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1226"},"\u7ba1\u63a7 1.2.26"),(0,s.kt)("p",null,"\u786e\u4fdd\u9002\u5f53\u5730\u8bbe\u7f6e\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"--request-timeout")," \u53c2\u6570\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u8bbe\u7f6e\u5168\u5c40\u8bf7\u6c42\u8d85\u65f6\u53ef\u4ee5\u5c06 API Server \u7684\u8bf7\u6c42\u8d85\u65f6\u9650\u5236\u5ef6\u957f\u5230\u4e0e\u7528\u6237\u7684\u8fde\u63a5\u901f\u5ea6\u76f8\u9002\u5e94\u7684\u65f6\u95f4\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a 60 \u79d2\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5728\u8fde\u63a5\u901f\u5ea6\u8f83\u6162\u65f6\u51fa\u73b0\u95ee\u9898\uff0c\u4e00\u65e6\u8bf7\u6c42\u7684\u6570\u636e\u91cf\u65e0\u6cd5\u5728 60 \u79d2\u5185\u5b8c\u6210\u4f20\u8f93\uff0c\u96c6\u7fa4\u8d44\u6e90\u5c06\u65e0\u6cd5\u8bbf\u95ee\u3002\u4f46\u662f\uff0c\u5982\u679c\u5c06\u8d85\u65f6\u9650\u5236\u7684\u503c\u8bbe\u7f6e\u5f97\u592a\u5927\uff0cAPI Server \u8d44\u6e90\u4f1a\u8017\u5c3d\uff0c\u56e0\u6b64\u4e5f\u5bb9\u6613\u53d7\u5230\u62d2\u7edd\u670d\u52a1\u653b\u51fb\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u9002\u5f53\u8bbe\u7f6e\u6b64\u9650\u5236\uff0c\u5e76\u4ec5\u5728\u9700\u8981\u65f6\u66f4\u6539\u9ed8\u8ba4\u7684 60 \u79d2\u9650\u5236\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1227"},"\u7ba1\u63a7 1.2.27"),(0,s.kt)("p",null,"\u786e\u4fdd ",(0,s.kt)("inlineCode",{parentName:"p"},"--service-account-lookup")," \u53c2\u6570\u8bbe\u7f6e\u4e3a true\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u5982\u679c\u672a\u542f\u7528 `--service-account-lookup`\uff0c\u5219 apiserver \u4ec5\u9a8c\u8bc1\u8eab\u4efd\u9a8c\u8bc1\u4ee4\u724c\u662f\u5426\u6709\u6548\uff0c\u4e0d\u4f1a\u9a8c\u8bc1\u8bf7\u6c42\u4e2d\u63d0\u5230\u7684 ServiceAccount \u4ee4\u724c\u662f\u5426\u5b9e\u9645\u5b58\u5728\u4e8e etcd \u4e2d\u3002\u8fd9\u4f7f\u5f97\u76f8\u5e94\u7684 ServiceAccount \u88ab\u5220\u9664\u540e\u4e5f\u53ef\u4ee5\u4f7f\u7528 ServiceAccount \u4ee4\u724c\u3002\u8fd9\u662f\u4e00\u4e2a\u4ece\u68c0\u67e5\u65f6\u95f4\u5230\u4f7f\u7528\u65f6\u95f4\u7684\u5b89\u5168\u95ee\u9898\u793a\u4f8b\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1233"},"\u7ba1\u63a7 1.2.33"),(0,s.kt)("p",null,"\u786e\u4fdd\u9002\u5f53\u5730\u8bbe\u7f6e\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"--encryption-provider-config")," \u53c2\u6570\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"etcd \u662f Kubernetes deployment \u4f7f\u7528\u7684\u9ad8\u53ef\u7528\u952e\u503c\u5b58\u50a8\uff0c\u7528\u4e8e\u6301\u4e45\u5b58\u50a8\u5176\u6240\u6709 REST API \u5bf9\u8c61\u3002\u8fd9\u4e9b\u5bf9\u8c61\u672c\u8d28\u4e0a\u662f\u654f\u611f\u7684\uff0c\u9700\u8981\u8fdb\u884c\u9759\u6001\u52a0\u5bc6\u4ee5\u907f\u514d\u6cc4\u9732\u3002",(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"/zh/security/secrets-encryption"},"Secret \u52a0\u5bc6"),"\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 K3s \u4e2d\u914d\u7f6e Secret \u52a0\u5bc6\u7684\u8be6\u7ec6\u6b65\u9aa4\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-1234"},"\u7ba1\u63a7 1.2.34"),(0,s.kt)("p",null,"\u786e\u4fdd\u6b63\u786e\u914d\u7f6e\u4e86\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u5728\u4f7f\u7528 etcd \u52a0\u5bc6\u7684\u5730\u65b9\uff0c\u4f7f\u7528\u9002\u5f53\u7684\u52a0\u5bc6\u63d0\u4f9b\u7a0b\u5e8f\u96c6\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u76ee\u524d\uff0c`aescbc`\u3001`kms` \u548c `secretbox` \u53ef\u80fd\u662f\u5408\u9002\u7684\u9009\u9879\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7\u5c06\u6709\u6548\u914d\u7f6e\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s")," \u6765\u89e3\u51b3\uff0c\u5982\u4e0a\u6240\u8ff0\u3002",(0,s.kt)("a",{parentName:"p",href:"/zh/security/secrets-encryption"},"Secret \u52a0\u5bc6"),"\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 K3s \u4e2d\u914d\u7f6e Secret \u52a0\u5bc6\u7684\u8be6\u7ec6\u6b65\u9aa4\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-131"},"\u7ba1\u63a7 1.3.1"),(0,s.kt)("p",null,"\u786e\u4fdd\u9002\u5f53\u5730\u8bbe\u7f6e\u4e86 ",(0,s.kt)("inlineCode",{parentName:"p"},"--terminated-pod-gc-threshold")," \u53c2\u6570\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"\u5783\u573e\u6536\u96c6\u5bf9\u4e8e\u786e\u4fdd\u8d44\u6e90\u7684\u53ef\u7528\u6027\u548c\u907f\u514d\u6027\u80fd\u4e0b\u964d\u975e\u5e38\u91cd\u8981\u3002\u5728\u6700\u574f\u7684\u60c5\u51b5\u4e0b\uff0c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u5d29\u6e83\u6216\u957f\u65f6\u95f4\u65e0\u6cd5\u4f7f\u7528\u3002\u5783\u573e\u6536\u96c6\u7684\u5f53\u524d\u8bbe\u7f6e\u662f 12,500 \u4e2a\u7ec8\u6b62\u7684 pod\uff0c\u5bf9\u4e8e\u4f60\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u8fd9\u4e2a\u503c\u53ef\u80fd\u592a\u9ad8\u4e14\u65e0\u6cd5\u7ef4\u6301\u3002\u6839\u636e\u4f60\u7684\u7cfb\u7edf\u8d44\u6e90\u548c\u6d4b\u8bd5\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u5408\u9002\u7684\u9608\u503c\u6765\u6fc0\u6d3b\u5783\u573e\u6536\u96c6\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-321"},"\u7ba1\u63a7 3.2.1"),(0,s.kt)("p",null,"\u786e\u4fdd\u521b\u5efa\u6700\u5c0f\u5ba1\u8ba1\u7b56\u7565"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"Logging \u662f\u6240\u6709\u7cfb\u7edf\u7684\u91cd\u8981\u68c0\u6d4b\u63a7\u5236\uff0c\u7528\u4e8e\u68c0\u6d4b\u6f5c\u5728\u7684\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u7ba1\u63a7 1.2.22 - 1.2.25 \u5e76\u9a8c\u8bc1\u5176\u6709\u6548\u6027\u6765\u89e3\u51b3\u95ee\u9898\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-427"},"\u7ba1\u63a7 4.2.7"),(0,s.kt)("p",null,"\u786e\u4fdd ",(0,s.kt)("inlineCode",{parentName:"p"},"--make-iptables-util-chains")," \u53c2\u6570\u8bbe\u7f6e\u4e3a true\u3002"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"Kubelets \u53ef\u4ee5\u6839\u636e\u4f60\u4e3a Pod \u9009\u62e9\u7684\u7f51\u7edc\u9009\u9879\u81ea\u52a8\u7ba1\u7406 iptables \u7684\u5fc5\u8981\u66f4\u6539\u3002\u5efa\u8bae\u8ba9 kubelets \u7ba1\u7406 iptables \u7684\u66f4\u6539\u3002\u8fd9\u6837\u80fd\u786e\u4fdd iptables \u7684\u914d\u7f6e\u4e0e Pod \u7f51\u7edc\u914d\u7f6e\u4fdd\u6301\u540c\u6b65\u3002\u4f7f\u7528\u52a8\u6001 Pod \u7f51\u7edc\u914d\u7f6e\u66f4\u6539\u6765\u624b\u52a8\u914d\u7f6e iptables \u53ef\u80fd\u4f1a\u59a8\u788d Pod/\u5bb9\u5668\u4e4b\u95f4\u4ee5\u53ca\u4e0e\u5916\u754c\u7684\u901a\u4fe1\u3002\u4f60\u7684 iptables \u89c4\u5219\u53ef\u80fd\u8fc7\u4e8e\u4e25\u683c\u6216\u8fc7\u4e8e\u5bbd\u677e\u3002",(0,s.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u4f5c\u4e3a\u503c\u4f20\u9012\u7ed9 ",(0,s.kt)("inlineCode",{parentName:"p"},"k3s server")," \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"--kube-apiserver-arg=")," \u53c2\u6570\u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u627e\u5230\u793a\u4f8b\u3002")),(0,s.kt)("h3",{id:"\u7ba1\u63a7-515"},"\u7ba1\u63a7 5.1.5"),(0,s.kt)("p",null,"\u786e\u4fdd\u672a\u4e3b\u52a8\u4f7f\u7528\u9ed8\u8ba4 ServiceAccount"),(0,s.kt)("details",null,(0,s.kt)("summary",null,"\u539f\u7406"),"Kubernetes \u4e3a\u96c6\u7fa4\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u4e86\u4e00\u4e2a `default` ServiceAccount\uff0c\u4f46\u6ca1\u6709\u4e3a pod \u5206\u914d\u7279\u5b9a ServiceAccount\u3002",(0,s.kt)("p",null,"\u5982\u679c\u9700\u8981\u4ece pod \u8bbf\u95ee Kubernetes API\uff0c\u5219\u9700\u8981\u4e3a\u8be5 pod \u521b\u5efa\u4e00\u4e2a\u7279\u5b9a\u7684 ServiceAccount \u5e76\u6388\u4e88\u6743\u9650\u3002"),(0,s.kt)("p",null,"\u4f60\u8fd8\u9700\u8981\u914d\u7f6e default  ServiceAccount\uff0c\u4f7f\u5176\u4e0d\u63d0\u4f9b ServiceAccount \u4ee4\u724c\u5e76\u4e14\u6ca1\u6709\u4efb\u4f55\u663e\u5f0f\u7684\u6743\u9650\u5206\u914d\u3002"),(0,s.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7\u5c06\u6bcf\u4e2a\u547d\u540d\u7a7a\u95f4\u4e2d ",(0,s.kt)("inlineCode",{parentName:"p"},"default")," ServiceAccount \u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"automountServiceAccountToken")," \u5b57\u6bb5\u66f4\u65b0\u4e3a ",(0,s.kt)("inlineCode",{parentName:"p"},"false")," \u6765\u89e3\u51b3\u6b64\u95ee\u9898\u3002"),(0,s.kt)("p",null,"\u5bf9\u4e8e\u5185\u7f6e\u547d\u540d\u7a7a\u95f4\uff08",(0,s.kt)("inlineCode",{parentName:"p"},"kube-system"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"kube-public"),"\u3001",(0,s.kt)("inlineCode",{parentName:"p"},"kube-node-lease")," \u548c ",(0,s.kt)("inlineCode",{parentName:"p"},"default"),"\uff09\u4e2d\u7684 ",(0,s.kt)("inlineCode",{parentName:"p"},"default")," ServiceAccount\uff0cK3s \u4e0d\u4f1a\u81ea\u52a8\u6267\u884c\u6b64\u64cd\u4f5c\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728\u8fd9\u4e9b ServiceAccount \u4e0a\u624b\u52a8\u66f4\u65b0\u6b64\u5b57\u6bb5\u6765\u4f20\u9012\u7ba1\u63a7\u3002")),(0,s.kt)("h2",{id:"control-plane-\u6267\u884c\u548c\u53c2\u6570"},"Control Plane \u6267\u884c\u548c\u53c2\u6570"),(0,s.kt)("p",null,"\u4e0b\u9762\u5217\u51fa\u4e86 K3s control plane \u7ec4\u4ef6\u53ca\u5176\u5728\u542f\u52a8\u65f6\u9ed8\u8ba4\u7684\u53c2\u6570\u3002\u53f3\u8fb9\u7684\u6ce8\u91ca\u662f\u4ed6\u4eec\u6ee1\u8db3\u7684 CIS 1.6 \u7ba1\u63a7\u3002"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kube-apiserver\n    --advertise-port=6443\n    --allow-privileged=true\n    --anonymous-auth=false                                                            # 1.2.1\n    --api-audiences=unknown\n    --authorization-mode=Node,RBAC\n    --bind-address=127.0.0.1\n    --cert-dir=/var/lib/rancher/k3s/server/tls/temporary-certs\n    --client-ca-file=/var/lib/rancher/k3s/server/tls/client-ca.crt                    # 1.2.31\n    --enable-admission-plugins=NodeRestriction,PodSecurityPolicy                      # 1.2.17\n    --etcd-cafile=/var/lib/rancher/k3s/server/tls/etcd/server-ca.crt                  # 1.2.32\n    --etcd-certfile=/var/lib/rancher/k3s/server/tls/etcd/client.crt                   # 1.2.29\n    --etcd-keyfile=/var/lib/rancher/k3s/server/tls/etcd/client.key                    # 1.2.29\n    --etcd-servers=https://127.0.0.1:2379\n    --insecure-port=0                                                                 # 1.2.19\n    --kubelet-certificate-authority=/var/lib/rancher/k3s/server/tls/server-ca.crt\n    --kubelet-client-certificate=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.crt\n    --kubelet-client-key=/var/lib/rancher/k3s/server/tls/client-kube-apiserver.key\n    --profiling=false                                                                 # 1.2.21\n    --proxy-client-cert-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.crt\n    --proxy-client-key-file=/var/lib/rancher/k3s/server/tls/client-auth-proxy.key\n    --requestheader-allowed-names=system:auth-proxy\n    --requestheader-client-ca-file=/var/lib/rancher/k3s/server/tls/request-header-ca.crt\n    --requestheader-extra-headers-prefix=X-Remote-Extra-\n    --requestheader-group-headers=X-Remote-Group\n    --requestheader-username-headers=X-Remote-User\n    --secure-port=6444                                                                # 1.2.20\n    --service-account-issuer=k3s\n    --service-account-key-file=/var/lib/rancher/k3s/server/tls/service.key            # 1.2.28\n    --service-account-signing-key-file=/var/lib/rancher/k3s/server/tls/service.key\n    --service-cluster-ip-range=10.43.0.0/16\n    --storage-backend=etcd3\n    --tls-cert-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt        # 1.2.30\n    --tls-private-key-file=/var/lib/rancher/k3s/server/tls/serving-kube-apiserver.key # 1.2.30\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kube-controller-manager\n    --address=127.0.0.1\n    --allocate-node-cidrs=true\n    --bind-address=127.0.0.1                                                       # 1.3.7\n    --cluster-cidr=10.42.0.0/16\n    --cluster-signing-cert-file=/var/lib/rancher/k3s/server/tls/client-ca.crt\n    --cluster-signing-key-file=/var/lib/rancher/k3s/server/tls/client-ca.key\n    --kubeconfig=/var/lib/rancher/k3s/server/cred/controller.kubeconfig\n    --port=10252\n    --profiling=false                                                              # 1.3.2\n    --root-ca-file=/var/lib/rancher/k3s/server/tls/server-ca.crt                   # 1.3.5\n    --secure-port=0\n    --service-account-private-key-file=/var/lib/rancher/k3s/server/tls/service.key # 1.3.4\n    --use-service-account-credentials=true                                         # 1.3.3\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kube-scheduler\n    --address=127.0.0.1\n    --bind-address=127.0.0.1                                              # 1.4.2\n    --kubeconfig=/var/lib/rancher/k3s/server/cred/scheduler.kubeconfig\n    --port=10251\n    --profiling=false                                                     # 1.4.1\n    --secure-port=0\n")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"kubelet\n    --address=0.0.0.0\n    --anonymous-auth=false                                                # 4.2.1\n    --authentication-token-webhook=true\n    --authorization-mode=Webhook                                          # 4.2.2\n    --cgroup-driver=cgroupfs\n    --client-ca-file=/var/lib/rancher/k3s/agent/client-ca.crt             # 4.2.3\n    --cloud-provider=external\n    --cluster-dns=10.43.0.10\n    --cluster-domain=cluster.local\n    --cni-bin-dir=/var/lib/rancher/k3s/data/223e6420f8db0d8828a8f5ed3c44489bb8eb47aa71485404f8af8c462a29bea3/bin\n    --cni-conf-dir=/var/lib/rancher/k3s/agent/etc/cni/net.d\n    --container-runtime-endpoint=/run/k3s/containerd/containerd.sock\n    --container-runtime=remote\n    --containerd=/run/k3s/containerd/containerd.sock\n    --eviction-hard=imagefs.available<5%,nodefs.available<5%\n    --eviction-minimum-reclaim=imagefs.available=10%,nodefs.available=10%\n    --fail-swap-on=false\n    --healthz-bind-address=127.0.0.1\n    --hostname-override=hostname01\n    --kubeconfig=/var/lib/rancher/k3s/agent/kubelet.kubeconfig\n    --kubelet-cgroups=/systemd/system.slice\n    --node-labels=\n    --pod-manifest-path=/var/lib/rancher/k3s/agent/pod-manifests\n    --protect-kernel-defaults=true                                        # 4.2.6\n    --read-only-port=0                                                    # 4.2.4\n    --resolv-conf=/run/systemd/resolve/resolv.conf\n    --runtime-cgroups=/systemd/system.slice\n    --serialize-image-pulls=false\n    --tls-cert-file=/var/lib/rancher/k3s/agent/serving-kubelet.crt        # 4.2.10\n    --tls-private-key-file=/var/lib/rancher/k3s/agent/serving-kubelet.key # 4.2.10\n")),(0,s.kt)("p",null,"\u4e0b\u9762\u547d\u4ee4\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5e94\u7528\u4fee\u6b63\u63aa\u65bd\u6765\u5f3a\u5316 K3s\uff1a"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"k3s server \\\n    --protect-kernel-defaults=true \\\n    --secrets-encryption=true \\\n    --kube-apiserver-arg='audit-log-path=/var/lib/rancher/k3s/server/logs/audit.log' \\\n    --kube-apiserver-arg='audit-policy-file=/var/lib/rancher/k3s/server/audit.yaml' \\\n    --kube-apiserver-arg='audit-log-maxage=30' \\\n    --kube-apiserver-arg='audit-log-maxbackup=10' \\\n    --kube-apiserver-arg='audit-log-maxsize=100' \\\n    --kube-apiserver-arg='request-timeout=300s' \\\n    --kube-apiserver-arg='service-account-lookup=true' \\\n    --kube-apiserver-arg='enable-admission-plugins=NodeRestriction,PodSecurityPolicy,NamespaceLifecycle,ServiceAccount' \\\n    --kube-controller-manager-arg='terminated-pod-gc-threshold=10' \\\n    --kube-controller-manager-arg='use-service-account-credentials=true' \\\n    --kubelet-arg='streaming-connection-idle-timeout=5m' \\\n    --kubelet-arg='make-iptables-util-chains=true'\n")),(0,s.kt)("h2",{id:"\u7ed3\u8bba"},"\u7ed3\u8bba"),(0,s.kt)("p",null,"\u5982\u679c\u9075\u5faa\u672c\u6307\u5357\uff0c\u4f60\u7684 K3s \u96c6\u7fa4\u5c06\u80fd\u7b26\u5408 CIS Kubernetes Benchmark\u3002\u4f60\u53ef\u4ee5\u67e5\u770b ",(0,s.kt)("a",{parentName:"p",href:"/zh/security/self-assessment"},"CIS Benchmark \u81ea\u6211\u8bc4\u4f30\u6307\u5357"),"\u6765\u4e86\u89e3\u6bcf\u9879 Benchmark \u68c0\u67e5\u7684\u671f\u671b\u7ed3\u679c\uff0c\u4ee5\u53ca\u5982\u4f55\u5728\u4f60\u7684\u96c6\u7fa4\u4e0a\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\u3002"))}d.isMDXComponent=!0}}]);