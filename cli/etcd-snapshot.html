<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cli/etcd-snapshot" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">etcd-snapshot | K3s</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.k3s.io/cli/etcd-snapshot"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" property="og:locale:alternate" content="kr"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="etcd-snapshot | K3s"><meta data-rh="true" name="description" content="This page documents the management of etcd snapshots using the k3s etcd-snapshot CLI, as well as configuration of etcd scheduled snapshots for the k3s server process, and use of the k3s server --cluster-reset command to reset etcd cluster membership and optionally restore etcd snapshots."><meta data-rh="true" property="og:description" content="This page documents the management of etcd snapshots using the k3s etcd-snapshot CLI, as well as configuration of etcd scheduled snapshots for the k3s server process, and use of the k3s server --cluster-reset command to reset etcd cluster membership and optionally restore etcd snapshots."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.k3s.io/cli/etcd-snapshot"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/cli/etcd-snapshot" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/zh/cli/etcd-snapshot" hreflang="zh"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/kr/cli/etcd-snapshot" hreflang="kr"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/ja/cli/etcd-snapshot" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.k3s.io/cli/etcd-snapshot" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.072ecdef.css">
<script src="/assets/js/runtime~main.f75d349a.js" defer="defer"></script>
<script src="/assets/js/main.d12cf90b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/k3s-logo-light.svg" alt="logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/k3s-logo-dark.svg" alt="logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/cli/etcd-snapshot" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh/cli/etcd-snapshot" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li><li><a href="/kr/cli/etcd-snapshot" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="kr">한국어</a></li><li><a href="/ja/cli/etcd-snapshot" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><a href="https://github.com/k3s-io/k3s/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn">GitHub</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">K3s - Lightweight Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quick-start">Quick-Start Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/installation">Installation</a><button aria-label="Expand sidebar category &#x27;Installation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/datastore">Cluster Datastore</a><button aria-label="Expand sidebar category &#x27;Cluster Datastore&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/upgrades">Upgrades</a><button aria-label="Expand sidebar category &#x27;Upgrades&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/security">Security</a><button aria-label="Expand sidebar category &#x27;Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/cli">CLI Tools</a><button aria-label="Collapse sidebar category &#x27;CLI Tools&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli/server">server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli/agent">agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli/certificate">certificate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cli/etcd-snapshot">etcd-snapshot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli/secrets-encrypt">secrets-encrypt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cli/token">token</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cluster-access">Cluster Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/storage">Volumes and Storage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/networking">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/helm">Helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/advanced">Advanced Options / Configuration</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/reference/env-variables">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/release-notes/v1.32.X">Release Notes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/related-projects">Related Projects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/known-issues">Known Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">FAQ</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cli"><span itemprop="name">CLI Tools</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">etcd-snapshot</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>k3s etcd-snapshot</h1></header>
<p>This page documents the management of etcd snapshots using the <code>k3s etcd-snapshot</code> CLI, as well as configuration of etcd scheduled snapshots for the <code>k3s server</code> process, and use of the <code>k3s server --cluster-reset</code> command to reset etcd cluster membership and optionally restore etcd snapshots.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-snapshots">Creating Snapshots<a href="#creating-snapshots" class="hash-link" aria-label="Direct link to Creating Snapshots" title="Direct link to Creating Snapshots">​</a></h2>
<p>Snapshots are saved to the path set by the server&#x27;s <code>--etcd-snapshot-dir</code> value, which defaults to <code>${data-dir}/server/db/snapshots</code>. The data-dir value defaults to <code>/var/lib/rancher/k3s</code> and can be changed independently by setting the <code>--data-dir</code> flag.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduled-snapshots">Scheduled Snapshots<a href="#scheduled-snapshots" class="hash-link" aria-label="Direct link to Scheduled Snapshots" title="Direct link to Scheduled Snapshots">​</a></h3>
<p>Scheduled snapshots are enabled by default, at 00:00 and 12:00 system time, with 5 snapshots retained. To configure the snapshot interval or the number of retained snapshots, refer to the <a href="#snapshot-configuration-options">snapshot configuration options</a>.</p>
<p>Scheduled snapshots have a name that starts with <code>etcd-snapshot</code>, followed by the node name and timestamp. The base name can be changed with the <code>--etcd-snapshot-name</code> flag in the server configuration.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="on-demand-snapshots">On-demand Snapshots<a href="#on-demand-snapshots" class="hash-link" aria-label="Direct link to On-demand Snapshots" title="Direct link to On-demand Snapshots">​</a></h3>
<p>Snapshots can be saved manually by running the <code>k3s etcd-snapshot save</code> command.</p>
<p>On-demand snapshots have a name that starts with <code>on-demand</code>, followed by the node name and timestamp. The base name can be changed with the <code>--name</code> flag when saving the snapshot.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="snapshot-configuration-options">Snapshot Configuration Options<a href="#snapshot-configuration-options" class="hash-link" aria-label="Direct link to Snapshot Configuration Options" title="Direct link to Snapshot Configuration Options">​</a></h3>
<p>These flags can be passed to the <code>k3s server</code> command to reset the etcd cluster, and optionally restore from a snapshot.</p>
<table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--cluster-reset</code></td><td>Forget all peers and become sole member of a new cluster. This can also be set with the environment variable <code>[$K3S_CLUSTER_RESET]</code></td></tr><tr><td><code>--cluster-reset-restore-path</code></td><td>Path to snapshot file to be restored</td></tr></tbody></table>
<p>These flags are valid for both <code>k3s server</code> and <code>k3s etcd-snapshot</code>, however when passed to <code>k3s etcd-snapshot</code> the <code>--etcd-</code> prefix can be omitted to avoid redundancy.
Flags can be passed in with the command line, or in the <a href="/installation/configuration#configuration-file">configuration file,</a> which may be easier to use.</p>
<table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--etcd-disable-snapshots</code></td><td>Disable scheduled snapshots</td></tr><tr><td><code>--etcd-snapshot-compress</code></td><td>Compress etcd snapshots</td></tr><tr><td><code>--etcd-snapshot-dir</code></td><td>Directory to save db snapshots. (Default location: <code>${data-dir}/db/snapshots</code>)</td></tr><tr><td><code>--etcd-snapshot-retention</code></td><td>Number of snapshots to retain (default: 5)</td></tr><tr><td><code>--etcd-snapshot-schedule-cron</code></td><td>Snapshot interval time in cron spec. eg. every 5 hours <code>0 */5 * * *</code> (default: <code>0 */12 * * *</code>)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="s3-compatible-object-store-support">S3 Compatible Object Store Support<a href="#s3-compatible-object-store-support" class="hash-link" aria-label="Direct link to S3 Compatible Object Store Support" title="Direct link to S3 Compatible Object Store Support">​</a></h3>
<p>K3s supports writing etcd snapshots to and restoring etcd snapshots from S3-compatible object stores. S3 support is available for both on-demand and scheduled snapshots.</p>
<table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--etcd-s3</code></td><td>Enable backup to S3</td></tr><tr><td><code>--etcd-s3-endpoint</code></td><td>S3 endpoint url</td></tr><tr><td><code>--etcd-s3-endpoint-ca</code></td><td>S3 custom CA cert to connect to S3 endpoint</td></tr><tr><td><code>--etcd-s3-skip-ssl-verify</code></td><td>Disables S3 SSL certificate validation</td></tr><tr><td><code>--etcd-s3-access-key</code></td><td>S3 access key</td></tr><tr><td><code>--etcd-s3-secret-key</code></td><td>S3 secret key</td></tr><tr><td><code>--etcd-s3-bucket</code></td><td>S3 bucket name</td></tr><tr><td><code>--etcd-s3-region</code></td><td>S3 region / bucket location (optional). defaults to us-east-1</td></tr><tr><td><code>--etcd-s3-folder</code></td><td>S3 folder</td></tr><tr><td><code>--etcd-s3-proxy</code></td><td>Proxy server to use when connecting to S3, overriding any proxy-releated environment variables</td></tr><tr><td><code>--etcd-s3-insecure</code></td><td>Disables S3 over HTTPS</td></tr><tr><td><code>--etcd-s3-timeout</code></td><td>S3 timeout (default: <code>5m0s</code>)</td></tr><tr><td><code>--etcd-s3-config-secret</code></td><td>Name of secret in the kube-system namespace used to configure S3, if etcd-s3 is enabled and no other etcd-s3 options are set</td></tr></tbody></table>
<p>To perform an on-demand etcd snapshot and save it to S3:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s etcd-snapshot save \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3-bucket=&lt;S3-BUCKET-NAME&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3-access-key=&lt;S3-ACCESS-KEY&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3-secret-key=&lt;S3-SECRET-KEY&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To perform an on-demand etcd snapshot restore from S3, first make sure that K3s isn&#x27;t running. Then run the following commands:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s server \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-init \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-reset \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --etcd-s3 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-reset-restore-path=&lt;SNAPSHOT-NAME&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --etcd-s3-bucket=&lt;S3-BUCKET-NAME&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --etcd-s3-access-key=&lt;S3-ACCESS-KEY&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --etcd-s3-secret-key=&lt;S3-SECRET-KEY&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="s3-configuration-secret-support">S3 Configuration Secret Support<a href="#s3-configuration-secret-support" class="hash-link" aria-label="Direct link to S3 Configuration Secret Support" title="Direct link to S3 Configuration Secret Support">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Version Gate</div><div class="admonitionContent_BuS1"><p>S3 Configuration Secret support is available as of the August 2024 releases: v1.30.4+k3s1, v1.29.8+k3s1, v1.28.13+k3s1</p></div></div>
<p>K3s supports reading etcd S3 snapshot configuration from a Kubernetes Secret.
This may be preferred to hardcoding credentials in K3s CLI flags or config files for security reasons, or if credentials need to be rotated without restarting K3s.
To pass S3 snapshot configuration via a Secret, start K3s with <code>--etcd-s3</code> and <code>--etcd-s3-config-secret=&lt;SECRET-NAME&gt;</code>.
The Secret does not need to exist when K3s is started, but it will be checked for every time a snapshot save/list/delete/prune operation is performed.</p>
<p>The S3 config Secret cannot be used when restoring a snapshot, as the apiserver is not available to provide the secret during a restore.
S3 configuration must be passed via the CLI when restoring a snapshot stored on S3.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Pass only the the <code>--etcd-s3</code> and <code>--etcd-s3-config-secret</code> flags to enable the Secret.<br>
<!-- -->If any other S3 configuration flags are set, the Secret will be ignored.</p></div></div>
<p>Keys in the Secret correspond to the <code>--etcd-s3-*</code> CLI flags listed above.
The <code>etcd-s3-endpoint-ca</code> key accepts a PEM-encoded CA bundle, or the <code>etcd-s3-endpoint-ca-name</code> key may be used to specify the name of a ConfigMap in the <code>kube-system</code> namespace containing one or more PEM-encoded CA bundles.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> k3s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">etcd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">snapshot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> kube</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> etcd.k3s.cattle.io/s3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">stringData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-endpoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-endpoint-ca</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-endpoint-ca-name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-skip-ssl-verify</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-access-key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AWS_ACCESS_KEY_ID&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-secret-key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;AWS_SECRET_ACCESS_KEY&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-bucket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bucket&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-folder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;folder&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;us-east-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-insecure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;false&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;5m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">etcd-s3-proxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="managing-snapshots">Managing Snapshots<a href="#managing-snapshots" class="hash-link" aria-label="Direct link to Managing Snapshots" title="Direct link to Managing Snapshots">​</a></h2>
<p>k3s supports a set of subcommands for working with your etcd snapshots.</p>
<table><thead><tr><th>Subcommand</th><th>Description</th></tr></thead><tbody><tr><td>delete</td><td>Delete given snapshot(s)</td></tr><tr><td>ls, list, l</td><td>List snapshots</td></tr><tr><td>prune</td><td>Remove snapshots that exceed the configured retention count</td></tr><tr><td>save</td><td>Trigger an immediate etcd snapshot</td></tr></tbody></table>
<p>These commands will perform as expected whether the etcd snapshots are stored locally or in an S3 compatible object store.</p>
<p>For additional information on the etcd snapshot subcommands, run <code>k3s etcd-snapshot --help</code>.</p>
<p>Delete a snapshot from S3.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s etcd-snapshot delete          \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3                            \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3-bucket=&lt;S3-BUCKET-NAME&gt;    \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3-access-key=&lt;S3-ACCESS-KEY&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --s3-secret-key=&lt;S3-SECRET-KEY&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &lt;SNAPSHOT-NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Prune local snapshots with the default retention policy (5). The <code>prune</code> subcommand takes an additional flag <code>--snapshot-retention</code> that allows for overriding the default retention policy.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s etcd-snapshot prune</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s etcd-snapshot prune --snapshot-retention 10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="etcdsnapshotfile-custom-resources">ETCDSnapshotFile Custom Resources<a href="#etcdsnapshotfile-custom-resources" class="hash-link" aria-label="Direct link to ETCDSnapshotFile Custom Resources" title="Direct link to ETCDSnapshotFile Custom Resources">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Version Gate</div><div class="admonitionContent_BuS1"><p>ETCDSnapshotFiles are available as of the November 2023 releases: v1.28.4+k3s2, v1.27.8+k3s2, v1.26.11+k3s2, v1.25.16+k3s4</p></div></div>
<p>Snapshots can be viewed remotely using any Kubernetes client by listing or describing cluster-scoped <code>ETCDSnapshotFile</code> resources.
Unlike the <code>k3s etcd-snapshot list</code> command, which only shows snapshots visible to that node, <code>ETCDSnapshotFile</code> resources track all snapshots present on cluster members.</p>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">root@k3s-server-1:~# kubectl get etcdsnapshotfile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                             SNAPSHOTNAME                        NODE           LOCATION                                                                            SIZE      CREATIONTIME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">local-on-demand-k3s-server-1-1730308816-3e9290   on-demand-k3s-server-1-1730308816   k3s-server-1   file:///var/lib/rancher/k3s/server/db/snapshots/on-demand-k3s-server-1-1730308816   2891808   2024-10-30T17:20:16Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">s3-on-demand-k3s-server-1-1730308816-79b15c      on-demand-k3s-server-1-1730308816   s3             s3://etcd/k3s-test/on-demand-k3s-server-1-1730308816                                2891808   2024-10-30T17:20:16Z</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">root@k3s-server-1:~# kubectl describe etcdsnapshotfile s3-on-demand-k3s-server-1-1730308816-79b15c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Name:         s3-on-demand-k3s-server-1-1730308816-79b15c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Namespace:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Labels:       etcd.k3s.cattle.io/snapshot-storage-node=s3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Annotations:  etcd.k3s.cattle.io/snapshot-token-hash: b4b83cda3099</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">API Version:  k3s.cattle.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Kind:         ETCDSnapshotFile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Creation Timestamp:  2024-10-30T17:20:16Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Finalizers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    wrangler.cattle.io/managed-etcd-snapshots-controller</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Generation:        1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Resource Version:  790</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  UID:               bec9a51c-dbbe-4746-922e-a5136bef53fc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Location:   s3://etcd/k3s-test/on-demand-k3s-server-1-1730308816</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Node Name:  s3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  s3:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Bucket:           etcd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Endpoint:         s3.example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Prefix:           k3s-test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Region:           us-east-1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Skip SSL Verify:  true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Snapshot Name:      on-demand-k3s-server-1-1730308816</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Status:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Creation Time:  2024-10-30T17:20:16Z</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Ready To Use:   true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Size:           2891808</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type    Reason               Age   From            Message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ----    ------               ----  ----            -------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Normal  ETCDSnapshotCreated  113s  k3s-supervisor  Snapshot on-demand-k3s-server-1-1730308816 saved on S3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="restoring-snapshots">Restoring Snapshots<a href="#restoring-snapshots" class="hash-link" aria-label="Direct link to Restoring Snapshots" title="Direct link to Restoring Snapshots">​</a></h2>
<p>K3s runs through several steps when restoring a snapshot:</p>
<ol>
<li>If the snapshot is stored on S3, the file is downloaded into the snapshot directory.</li>
<li>If the snapshot is compressed, it is decompressed.</li>
<li>If present, the current etcd database files are moved to <code>${data-dir}/server/db/etcd-old-$TIMESTAMP/</code>.</li>
<li>The snapshot&#x27;s contents are extracted out to disk, and the checksum is verified.</li>
<li>Etcd is started, and all etcd cluster members except the current node are removed from the cluster.</li>
<li>CA Certificates and other confidential data are extracted from the datastore and written to disk, for later use.</li>
<li>The restore is complete, and K3s can be restarted and used normally on the server where the restore was performed.</li>
<li>(optional) Agents and control-plane servers can be started normally.</li>
<li>(optional) Etcd servers can be restarted to rejoin to the cluster after removing old database files.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="snapshot-restore-steps">Snapshot Restore Steps<a href="#snapshot-restore-steps" class="hash-link" aria-label="Direct link to Snapshot Restore Steps" title="Direct link to Snapshot Restore Steps">​</a></h3>
<p>Select the tab below that matches your cluster configuration.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Single Server</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Multiple Servers</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><ol>
<li>
<p>Stop the K3s service:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl stop k3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Run <code>k3s server</code> with the <code>--cluster-reset</code> flag, and <code>--cluster-reset-restore-path</code> indicating the path to the snapshot to restore.
If the snapshot is stored on S3, provide S3 configuration flags (<code>--etcd-s3</code>, <code>--etcd-s3-bucket</code>, and so on), and give only the filename name of the snapshot as the restore path.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Using the <code>--cluster-reset</code> flag without specifying a snapshot to restore simply resets the etcd cluster to a single member without restoring a snapshot.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s server \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-reset \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Result:</strong> K3s restores the snapshot and resets cluster membership, then prints a message indicating that it is ready to be restarted:<br>
<code>Managed etcd cluster membership has been reset, restart without --cluster-reset flag now.</code></p>
</li>
<li>
<p>Start K3s again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start k3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>In this example there are 3 servers, <code>S1</code>, <code>S2</code>, and <code>S3</code>. The snapshot is located on <code>S1</code>.</p><ol>
<li>
<p>Stop K3s on all servers:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl stop k3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>On S1, run <code>k3s server</code> with the <code>--cluster-reset</code> option, and <code>--cluster-reset-restore-path</code> indicating the path to the snapshot to restore.
If the snapshot is stored on S3, provide S3 configuration flags (<code>--etcd-s3</code>, <code>--etcd-s3-bucket</code>, and so on), and give only the filename name of the snapshot as the restore path.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Using the <code>--cluster-reset</code> flag without specifying a snapshot to restore simply resets the etcd cluster to a single member without restoring a snapshot.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">k3s server \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-reset \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --cluster-reset-restore-path=&lt;PATH-TO-SNAPSHOT&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Result:</strong> K3s restores the snapshot and resets cluster membership, then prints a message indicating that it is ready to be restarted:<br>
<code>Managed etcd cluster membership has been reset, restart without --cluster-reset flag now.</code><br>
<code>Backup and delete ${datadir}/server/db on each peer etcd server and rejoin the nodes.</code></p>
</li>
<li>
<p>On S1, start K3s again:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start k3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>On S2 and S3, delete the data directory, <code>/var/lib/rancher/k3s/server/db/</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rm -rf /var/lib/rancher/k3s/server/db/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>On S2 and S3, start K3s again to join the restored cluster:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">systemctl start k3s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/k3s-io/docs/edit/main/docs/cli/etcd-snapshot.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-02-18T19:14:14.000Z" itemprop="dateModified">Feb 18, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cli/certificate"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">certificate</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cli/secrets-encrypt"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">secrets-encrypt</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-snapshots" class="table-of-contents__link toc-highlight">Creating Snapshots</a><ul><li><a href="#scheduled-snapshots" class="table-of-contents__link toc-highlight">Scheduled Snapshots</a></li><li><a href="#on-demand-snapshots" class="table-of-contents__link toc-highlight">On-demand Snapshots</a></li><li><a href="#snapshot-configuration-options" class="table-of-contents__link toc-highlight">Snapshot Configuration Options</a></li><li><a href="#s3-compatible-object-store-support" class="table-of-contents__link toc-highlight">S3 Compatible Object Store Support</a></li><li><a href="#s3-configuration-secret-support" class="table-of-contents__link toc-highlight">S3 Configuration Secret Support</a></li></ul></li><li><a href="#managing-snapshots" class="table-of-contents__link toc-highlight">Managing Snapshots</a><ul><li><a href="#etcdsnapshotfile-custom-resources" class="table-of-contents__link toc-highlight">ETCDSnapshotFile Custom Resources</a></li></ul></li><li><a href="#restoring-snapshots" class="table-of-contents__link toc-highlight">Restoring Snapshots</a><ul><li><a href="#snapshot-restore-steps" class="table-of-contents__link toc-highlight">Snapshot Restore Steps</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 K3s Project Authors. All rights reserved. <br>The Linux Foundation has registered trademarks
      and uses trademarks. For a list of trademarks of The Linux Foundation, 
      please see our <a href="https://www.linuxfoundation.org/trademark-usage"> Trademark Usage</a> page.</div></div></div></footer></div>
</body>
</html>